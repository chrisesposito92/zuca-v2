name: summarize-criteria
version: "1.1"
step: summarize
description: Rules for summary generation (consolidated assumptions and open questions)

# NOTE: The summarize step outputs only:
# - assumptions: array of consolidated assumption strings
# - open_questions: array of consolidated question strings
# Financial metrics (TCV, charge counts) are NOT in this output.
# This step consolidates and prioritizes assumptions/questions from earlier steps.

criteria:
  - id: SM-001
    name: assumption-deduplication
    description: Assumptions must be consolidated without duplicates
    severity: high
    patterns: [duplicate, consolidate, assumptions]
    check:
      type: behavioral
      rule: |
        The assumptions array should be:
        - Deduplicated (no near-duplicates or redundant entries)
        - Grouped by related topic where possible
        - Ordered by business impact (critical → minor)
        - Reworded for clarity if original wording was ambiguous
        Each assumption should provide clear, actionable information.

  - id: SM-002
    name: open-question-priority-tags
    description: Open questions must have priority tags
    severity: high
    patterns: [priority, BLOCKING, HIGH, MEDIUM, open question]
    check:
      type: behavioral
      rule: |
        Each open question in open_questions should have a priority tag prefix:
        - [BLOCKING] — Cannot finalize solution without answer
        - [HIGH] — Significantly impacts accuracy
        - [MEDIUM] — Would improve solution quality
        Tag format: "[TAG] Question text here"

  - id: SM-003
    name: question-deduplication
    description: Open questions must be consolidated without duplicates
    severity: medium
    patterns: [duplicate, consolidate, questions]
    check:
      type: behavioral
      rule: |
        The open_questions array should be:
        - Deduplicated (no near-duplicates)
        - Ordered by priority (BLOCKING → HIGH → MEDIUM)
        - Clear and specific about what information is needed
        Each question should be actionable for the user.

  - id: SM-004
    name: source-attribution
    description: Items should indicate their source step
    severity: low
    patterns: [source, step, attribution]
    check:
      type: behavioral
      rule: |
        Assumptions and questions should ideally indicate which
        pipeline step they originated from, using prefixes like:
        - [Subscription], [POB Mapping], [Contracts/Orders]
        - [Billings], [Rev Rec]
        This helps users trace where each item came from.

  - id: SM-005
    name: no-empty-arrays
    description: Arrays should not be empty if earlier steps had items
    severity: medium
    patterns: [empty, missing, consolidation]
    check:
      type: behavioral
      rule: |
        If earlier pipeline steps generated assumptions or
        open questions, the summary should consolidate them.
        Empty arrays are only acceptable if no earlier steps
        produced any assumptions or questions.

  - id: SM-006
    name: actionable-content
    description: Content should be actionable and specific
    severity: medium
    patterns: [actionable, specific, vague]
    check:
      type: behavioral
      rule: |
        Each assumption and question should be:
        - Specific (not vague generalizations)
        - Actionable (user knows what to do/answer)
        - Relevant to the use case (no boilerplate)
        Avoid generic statements like "Verify with customer"
        without specifying what to verify.
