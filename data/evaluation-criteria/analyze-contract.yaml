name: analyze-contract-criteria
version: "1.0"
step: analyze_contract
description: Rules for contract analysis and capability detection

criteria:
  - id: AC-001
    name: service-period-extraction
    description: Service dates must be accurately extracted from contract
    severity: critical
    patterns: [service period, contract dates, start date, end date]
    check:
      type: behavioral
      rule: |
        Contract start and end dates must be correctly extracted.
        If the contract specifies dates in any format, they must be
        converted to MM/DD/YYYY format accurately.

  - id: AC-002
    name: term-calculation
    description: Term months must match the service period
    severity: high
    patterns: [term, months, duration, contract length]
    check:
      type: numeric
      rule: |
        term_months must equal the number of months between
        service_start_mdy and service_end_mdy (inclusive).
      threshold: 0

  - id: AC-003
    name: billing-period-detection
    description: Billing period must be accurately detected
    severity: high
    patterns: [billing, payment, monthly, quarterly, annual]
    check:
      type: behavioral
      rule: |
        billing_period must match what is specified in the contract.
        Valid values: "Month", "Quarter", "Semi-Annual", "Year".
        If monthly billing is mentioned, use "Month".
        If quarterly, use "Quarter".
        Default to "Month" if not specified.

  - id: AC-004
    name: ramp-detection
    description: Multi-period pricing must be detected as ramp scenarios
    severity: high
    patterns: [ramp, step-up, introductory, promotional, year 1, year 2]
    check:
      type: behavioral
      rule: |
        If the contract has different prices for different periods
        (e.g., "first 3 months at $15, then $20"), this MUST be
        detected and flagged in the capabilities as a ramp or
        multi-segment pricing scenario.

  - id: AC-005
    name: billing-caps-completeness
    description: All relevant billing capabilities must be detected
    severity: medium
    patterns: [billing, capabilities, features]
    check:
      type: behavioral
      rule: |
        billing_caps array must include all capabilities mentioned
        or implied by the contract. Use UPPERCASE label format.
        Common patterns to capability mappings:
        - "recurring", "subscription" → Recurring charge
        - "one-time setup/implementation" → One-time charge
        - "usage", "metered", "consumption" → Usage charge
        - "tiered pricing", "volume discount" → Tiered/Volume pricing
        - "prepaid credits", "drawdown" → Prepaid drawdown
        - "minimum commit" → Min commit
        - "upgrade/downgrade mid-term" → Amendment

  - id: AC-006
    name: revenue-caps-completeness
    description: All relevant revenue capabilities must be detected
    severity: medium
    patterns: [revenue, recognition, ASC 606]
    check:
      type: behavioral
      rule: |
        revenue_caps array must include relevant recognition methods.
        Use UPPERCASE label format. Common patterns to capability mappings:
        - "SSP", "standalone selling price" → Allocation
        - "bundle", "package" with components → Bundle
        - "ramp", "escalating", "YoY increase" → Ramp
        - "variable consideration", "rebate" → VC
        - "amend", "modify mid-term" → Contract mod
        - "over time", "ratable" → Over-time recognition
        - "point-in-time", "immediately" → Point-in-time recognition

  - id: AC-007
    name: trigger-event-accuracy
    description: Trigger event must match contract terms
    severity: high
    patterns: [trigger, start, effective, activation]
    check:
      type: behavioral
      rule: |
        trigger_event must be set appropriately:
        - "ContractEffective" for standard contracts (default)
        - "ServiceActivation" if activation is mentioned
        - "CustomerAcceptance" if formal acceptance required
        Use camelCase format without spaces.
