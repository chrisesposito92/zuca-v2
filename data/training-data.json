{
  "version": "1.0",
  "created_at": "2025-12-31T03:42:34.409Z",
  "updated_at": "2025-12-31T03:42:34.409Z",
  "stats": {
    "total_examples": 8,
    "by_step": {
      "contracts_orders": 3,
      "billings": 4,
      "revrec_waterfall": 1
    },
    "by_source": {
      "evaluation_pass": 8
    }
  },
  "examples": [
    {
      "id": "e29c6468-2f3a-4806-9cf9-949597297f2a",
      "step_name": "contracts_orders",
      "source": "evaluation_pass",
      "messages": [
        {
          "role": "system",
          "content": "You are a Zuora Revenue expert generating the RC_LINE (Contracts/Orders) table. This table is the foundation for revenue recognition—every charge becomes a line item with pricing and allocation data.\n\n---\n\n## Input Context\n\nYou will receive:\n- **Subscription spec** — charges with pricing, dates, quantities\n- **POB mapping** — template assignments for each charge (use these exactly)\n- **Contract intel** — dates and terms\n- **Allocation settings** — is_allocations flag and method\n\n---\n\n## Line Item Generation\n\n### One Line Per Charge\n\nCreate exactly ONE row for each charge from the subscription spec:\n\n| Charge in Sub Spec | → Line in Contracts/Orders |\n|-------------------|---------------------------|\n| \"Platform License - Year 1\" | Line 1: Platform License - Year 1 |\n| \"Platform License - Year 2\" | Line 2: Platform License - Year 2 |\n| \"Implementation Fee\" | Line 3: Implementation Fee |\n\n### Line Item Fields\n\nFor each line, populate:\n\n**Identity:**\n- `Line Item Num`: Sequential (1, 2, 3...)\n- `POB Name`: Charge name from subscription spec\n- `POB Template`: From POB mapping (exact match)\n- `POB IDENTIFIER`: From POB mapping (exact match)\n- `Customer Name`: From input\n- `Subscription Name`: From subscription spec\n- `Subscription Version`: 1 (for new) or increment for amendments\n\n**Charge Details:**\n- `RPC Segment`: Charge name reference\n- `RPC Type`: Recurring/OneTime/Usage\n- `Billing Period`: Month/Quarter/Annual\n- `Billing Timing`: InAdvance/InArrears\n- `Trigger Event`: From charge\n- `Terms Months`: From contract intel\n\n**Revenue Window:**\n- `Revenue Start Date`: From charge effectiveStartDate (YYYY-MM-DD format)\n- `Revenue End Date`: From charge effectiveEndDate (YYYY-MM-DD format)\n- `Sales Order Date`: Contract effective date (MM/DD/YYYY format)\n\n**Pricing:**\n- `Ordered Qty`: From charge quantity (default 1)\n- `Unit List Price`: From charge listPrice\n- `Unit Sell Price`: From charge sellPrice\n- `Ext List Price`: Qty × Unit List Price\n- `Ext Sell Price`: Qty × Unit Sell Price\n\n**Allocation (see below):**\n- `SSP Price`: Unit SSP (typically = Unit List Price unless override)\n- `Ext SSP Price`: Qty × SSP Price\n- `SSP Percent`: Line Ext SSP / Total Ext SSP × 100\n- `Ext Allocated Price`: Result of allocation calculation\n- `Allocation Eligible Flag`: true if is_allocations=true\n\n**Status:**\n- `Release Event`: From POB mapping\n- `POB Satisfied`: \"Over Time\" or \"Point In Time\" from template\n- `Lead Line`: true for first/main line, false for others\n- `Carves Adjustment`: 0 (unless explicit carve)\n- `Unreleased Revenue`: = Ext Allocated Price (initially)\n- `Released Revenue`: 0 (initially)\n\n**Classification:**\n- `Product Category`: Infer from charge/product name\n- `Product Family`: Infer from charge/product name\n\n---\n\n## Allocation Calculations\n\n### When is_allocations = false\n- `Ext Allocated Price` = `Ext Sell Price`\n- `SSP Percent` = proportional to Ext Sell Price\n- No redistribution\n\n### When is_allocations = true\n\n**Step 1: Calculate SSP totals**\n```\nTotal Ext SSP = Sum of all Ext SSP Price\nTotal Transaction Price = Sum of all Ext Sell Price\n```\n\n**Step 2: Calculate SSP percentages**\n```\nFor each line:\nSSP Percent = (Line Ext SSP Price / Total Ext SSP) × 100\n```\n\n**Step 3: Allocate transaction price**\n```\nFor each line:\nExt Allocated Price = Total Transaction Price × (SSP Percent / 100)\n```\n\n**Step 4: Validate**\n- Sum of Ext Allocated Price must equal Sum of Ext Sell Price\n\n### Ramp Deals (Override Standard Allocation)\n\nWhen charges are ramp segments (same service, different periods/prices):\n\n1. Group ramp charges together\n2. Calculate average price across all ramp periods:\n   - **Term-based**: Simple average of period prices\n   - **Volume-based**: Weighted by quantities\n3. Allocate using average price for each period\n\n**Example:** Year 1: $10,000, Year 2: $12,000, Year 3: $14,000\n- Total: $36,000 over 3 years\n- Term-based average: $12,000/year\n- Each year allocates as if $12,000 (recognition spread evenly)\n\n### Variable Consideration (VC)\n\nWhen charges have uncertain amounts (rebates, refund rights, performance bonuses):\n\n1. Only include VC to the extent a significant reversal is NOT probable\n2. Use constrained estimate for allocation\n3. When uncertainty resolves, adjust in that period\n\n### Carves (Carve-In / Carve-Out)\n\nWhen specific POBs need revenue adjustment:\n- `Carves Adjustment` reflects movement between POBs\n- Net sum of all carves = 0\n- Carve-out reduces source POB, carve-in increases destination\n\n---\n\n## Special Scenarios\n\n### Bundle Explosion\n\nWhen one billing charge creates multiple revenue lines:\n- Create separate lines for each component\n- Each component has its own POB template\n- SSP comes from bundle config\n- Allocate across components\n- Total allocated = Original bundle price\n\n### Contract Modifications\n\n**New Contract (Version 1):**\n- Fresh allocation across all lines\n\n**Amendment (Version 2+):**\n- Increment Subscription Version\n- Sales Order Date = Amendment date\n- Retrospective: Reallocate all lines\n- Prospective: Only new lines allocated, existing unchanged\n\n---\n\n## Output\n\nReturn JSON with ALL fields populated:\n\n```json\n{\n  \"zr_contracts_orders\": [\n    {\n      \"POB Name\": \"Platform License\",\n      \"POB Template\": \"BK-OT-RATABLE\",\n      \"POB Satisfied\": \"Over Time\",\n      \"Release Event\": \"Upon Booking (Full Booking Release)\",\n      \"Billing Period\": \"Month\",\n      \"Billing Timing\": \"InAdvance\",\n      \"Terms Months\": 12,\n      \"Trigger Event\": \"ContractEffective\",\n      \"Lead Line\": true,\n      \"Ordered Qty\": 1,\n      \"Line Item Num\": 1,\n      \"Subscription Name\": \"Acme Corp - Subscription\",\n      \"Subscription Version\": 1,\n      \"Sales Order Date\": \"01/01/2026\",\n      \"RPC Segment\": \"Platform License\",\n      \"RPC Type\": \"Recurring\",\n      \"Revenue Start Date\": \"2026-01-01\",\n      \"Revenue End Date\": \"2026-12-31\",\n      \"Unit List Price\": 1200,\n      \"Unit Sell Price\": 1000,\n      \"Ext List Price\": 1200,\n      \"Ext Sell Price\": 1000,\n      \"SSP Price\": 1200,\n      \"Ext SSP Price\": 1200,\n      \"SSP Percent\": 100,\n      \"Ext Allocated Price\": 1000,\n      \"Carves Adjustment\": 0,\n      \"Allocation Eligible Flag\": true,\n      \"Unreleased Revenue\": 1000,\n      \"Released Revenue\": 0,\n      \"Customer Name\": \"Acme Corp\",\n      \"POB IDENTIFIER\": \"BK-OT-RATABLE\",\n      \"Product Category\": \"Software\",\n      \"Product Family\": \"Platform\"\n    }\n  ],\n  \"assumptions\": [\"SSP equals List Price for all lines\"],\n  \"open_questions\": []\n}\n```\n\n**Critical validations before returning:**\n1. Sum(Ext Allocated Price) = Sum(Ext Sell Price)\n2. Revenue Start Date ≤ Revenue End Date for all lines\n3. Every charge from subscription spec has a corresponding line\n4. POB identifiers match the POB mapping exactly\n\n---\n\n## Reference Documentation\n\n- SSP Allocation: https://docs.zuora.com/en/zuora-revenue/advanced-revenue-operations/ssp-assignment-and-allocation\n- Ramp Deals: https://docs.zuora.com/en/zuora-revenue/day-to-day-operation/ramp-deals\n- VC Processing: https://docs.zuora.com/en/zuora-revenue/day-to-day-operation/variable-consideration-processing\n- Contract Modifications: https://docs.zuora.com/en/zuora-revenue/advanced-revenue-operations/contract-modifications\n- Bundle Explosion: https://docs.zuora.com/en/zuora-revenue/advanced-revenue-operations/bundle-explosion"
        },
        {
          "role": "user",
          "content": "{\n  \"customer_name\": \"Mint Mobile\",\n  \"contract_start_date\": \"01/01/2026\",\n  \"terms_months\": 12,\n  \"transaction_currency\": \"USD\",\n  \"billing_period\": \"Monthly\",\n  \"is_allocations\": false,\n  \"use_case_description\": \"Mint Mobile wireless plan:\\n- 3 months at $15/month introductory rate\\n- 9 months at $20/month standard rate\\n- Monthly billing in advance\\n\"\n}"
        },
        {
          "role": "assistant",
          "content": "{\n  \"zr_contracts_orders\": [\n    {\n      \"POB Name\": \"Wireless Plan - Intro Rate\",\n      \"POB Template\": \"BK-OT-RATABLE\",\n      \"POB Satisfied\": \"Over Time\",\n      \"Release Event\": \"Upon Booking (Full Booking Release)\",\n      \"Billing Period\": \"Month\",\n      \"Billing Timing\": \"InAdvance\",\n      \"Terms Months\": 12,\n      \"Trigger Event\": \"ContractEffective\",\n      \"Lead Line\": true,\n      \"Ordered Qty\": 1,\n      \"Line Item Num\": 1,\n      \"Subscription Name\": \"Mint Mobile - Wireless Subscription\",\n      \"Subscription Version\": 1,\n      \"Sales Order Date\": \"01/01/2026\",\n      \"RPC Segment\": \"Wireless Plan - Intro Rate\",\n      \"RPC Type\": \"Recurring\",\n      \"Revenue Start Date\": \"2026-01-01\",\n      \"Revenue End Date\": \"2026-03-31\",\n      \"Unit List Price\": 45,\n      \"Unit Sell Price\": 45,\n      \"Ext List Price\": 45,\n      \"Ext Sell Price\": 45,\n      \"SSP Price\": 45,\n      \"Ext SSP Price\": 45,\n      \"SSP Percent\": 20,\n      \"Ext Allocated Price\": 45,\n      \"Carves Adjustment\": 0,\n      \"Allocation Eligible Flag\": false,\n      \"Unreleased Revenue\": 45,\n      \"Released Revenue\": 0,\n      \"Customer Name\": \"Mint Mobile\",\n      \"POB IDENTIFIER\": \"BK-OT-RATABLE\",\n      \"Product Category\": \"Wireless\",\n      \"Product Family\": \"Wireless Service\"\n    },\n    {\n      \"POB Name\": \"Wireless Plan - Standard Rate\",\n      \"POB Template\": \"BK-OT-RATABLE\",\n      \"POB Satisfied\": \"Over Time\",\n      \"Release Event\": \"Upon Booking (Full Booking Release)\",\n      \"Billing Period\": \"Month\",\n      \"Billing Timing\": \"InAdvance\",\n      \"Terms Months\": 12,\n      \"Trigger Event\": \"ContractEffective\",\n      \"Lead Line\": false,\n      \"Ordered Qty\": 1,\n      \"Line Item Num\": 2,\n      \"Subscription Name\": \"Mint Mobile - Wireless Subscription\",\n      \"Subscription Version\": 1,\n      \"Sales Order Date\": \"01/01/2026\",\n      \"RPC Segment\": \"Wireless Plan - Standard Rate\",\n      \"RPC Type\": \"Recurring\",\n      \"Revenue Start Date\": \"2026-04-01\",\n      \"Revenue End Date\": \"2026-12-31\",\n      \"Unit List Price\": 180,\n      \"Unit Sell Price\": 180,\n      \"Ext List Price\": 180,\n      \"Ext Sell Price\": 180,\n      \"SSP Price\": 180,\n      \"Ext SSP Price\": 180,\n      \"SSP Percent\": 80,\n      \"Ext Allocated Price\": 180,\n      \"Carves Adjustment\": 0,\n      \"Allocation Eligible Flag\": false,\n      \"Unreleased Revenue\": 180,\n      \"Released Revenue\": 0,\n      \"Customer Name\": \"Mint Mobile\",\n      \"POB IDENTIFIER\": \"BK-OT-RATABLE\",\n      \"Product Category\": \"Wireless\",\n      \"Product Family\": \"Wireless Service\"\n    }\n  ],\n  \"assumptions\": [\n    \"Intro Rate calculated as $15 * 3 months = $45 total contract value for that segment.\",\n    \"Standard Rate calculated as $20 * 9 months = $180 total contract value for that segment.\",\n    \"Allocation Eligible Flag is set to false as per user instructions, resulting in Allocated Price equaling Sell Price.\",\n    \"SSP is assumed to equal List Price for calculation of SSP Percentages.\",\n    \"Lead Line is assigned to the first chronological charge segment.\"\n  ],\n  \"open_questions\": [\n    \"Should the ramp segments be treated as a single POB with an averaged rate (Ramp Deal logic) despite the 'No Allocations' instruction?\",\n    \"Is there a specific Product Category/Family hierarchy preferred by Mint Mobile for these wireless plans?\"\n  ]\n}"
        }
      ],
      "metadata": {
        "test_case_id": "mint-mobile-intro-pricing",
        "model": "gemini-3-flash-preview",
        "run_id": "a56ca45d-6bd5-43b5-a765-248eb581ed3c",
        "created_at": "2025-12-31T03:35:07.101Z"
      }
    },
    {
      "id": "0676efba-ecff-496e-90d4-d03b1ddc2e36",
      "step_name": "billings",
      "source": "evaluation_pass",
      "messages": [
        {
          "role": "system",
          "content": "You are a Zuora Billing expert generating the complete invoice schedule. For each charge in the subscription, calculate when invoices are generated and for what amounts.\n\n---\n\n## Input Context\n\nYou will receive:\n- **Subscription spec** — charges with pricing, billing period, billing timing\n- **Contract intel** — serviceStart, serviceEnd, termMonths\n\n---\n\n## Billing Schedule Generation\n\n### By Charge Type\n\n**Recurring Charges:**\nGenerate one billing row per billing period from effectiveStartDate to effectiveEndDate.\n\n**OneTime Charges:**\nGenerate one billing row on the trigger date.\n\n**Usage Charges:**\n- If usage records provided: Calculate billing per usage period\n- If no usage: Note in open_questions that usage billing is TBD\n\n---\n\n## Billing Date Calculation\n\n### Billing Timing Rules\n\n| billingTiming | Billing Date | Service Covered |\n|---------------|--------------|-----------------|\n| InAdvance | Period Start | Start → End of period |\n| InArrears | Period End | Start → End of period |\n\n### Billing Period Lengths\n\n| billingPeriod | Duration |\n|---------------|----------|\n| Month | 1 month |\n| Quarter | 3 months |\n| Semi-Annual | 6 months |\n| Annual | 12 months |\n\n---\n\n## Step-by-Step for Recurring Charges\n\n1. **Identify billing periods:**\n   - Start at charge effectiveStartDate\n   - End at charge effectiveEndDate (or subscriptionEndDate if null)\n   - Divide into periods based on billingPeriod\n\n2. **Calculate billing dates:**\n   - InAdvance: billing date = period start date\n   - InArrears: billing date = period end date\n\n3. **Calculate amounts:**\n   - Full period: Amount = quantity × unitPrice\n   - Partial period (proration): Amount = fullAmount × (days in partial / days in full period)\n\n### Proration Rules\n\nProrate when:\n- First period starts mid-period (e.g., Jan 15 for monthly billing)\n- Last period ends mid-period (e.g., ends June 15 for monthly billing)\n- Charge effectiveDates don't align with billing period boundaries\n\n**Proration calculation:**\n```\nProrated Amount = Full Period Amount × (Actual Days / Full Period Days)\n```\n\n---\n\n## Examples\n\n### Example 1: Monthly In Advance, 12 months\n- Contract: 01/01/2026 - 12/31/2026\n- Charge: $100/month, Monthly, InAdvance\n\n| Invoice Date | Billing Date | Period Start | Period End | Amount |\n|--------------|--------------|--------------|------------|--------|\n| 01/01/2026 | 01/01/2026 | 01/01/2026 | 01/31/2026 | $100 |\n| 02/01/2026 | 02/01/2026 | 02/01/2026 | 02/28/2026 | $100 |\n| ... | ... | ... | ... | $100 |\n| 12/01/2026 | 12/01/2026 | 12/01/2026 | 12/31/2026 | $100 |\n\n### Example 2: Quarterly In Arrears\n- Contract: 01/01/2026 - 12/31/2026\n- Charge: $3,000/quarter, Quarterly, InArrears\n\n| Invoice Date | Billing Date | Period Start | Period End | Amount |\n|--------------|--------------|--------------|------------|--------|\n| 03/31/2026 | 03/31/2026 | 01/01/2026 | 03/31/2026 | $3,000 |\n| 06/30/2026 | 06/30/2026 | 04/01/2026 | 06/30/2026 | $3,000 |\n| 09/30/2026 | 09/30/2026 | 07/01/2026 | 09/30/2026 | $3,000 |\n| 12/31/2026 | 12/31/2026 | 10/01/2026 | 12/31/2026 | $3,000 |\n\n### Example 3: Annual In Advance, One-Time Fee\n- Contract: 01/01/2026 - 12/31/2026\n- Charge 1: Annual license $12,000, Annual, InAdvance\n- Charge 2: Implementation $5,000, OneTime\n\n| Invoice Date | Billing Date | Charge Name | Period Start | Period End | Amount |\n|--------------|--------------|-------------|--------------|------------|--------|\n| 01/01/2026 | 01/01/2026 | Annual License | 01/01/2026 | 12/31/2026 | $12,000 |\n| 01/01/2026 | 01/01/2026 | Implementation | 01/01/2026 | 01/01/2026 | $5,000 |\n\n### Example 4: Proration (Mid-Month Start)\n- Contract: 01/15/2026 - 12/31/2026\n- Charge: $100/month, Monthly, InAdvance\n\n| Invoice Date | Billing Date | Period Start | Period End | Amount | Notes |\n|--------------|--------------|--------------|------------|--------|-------|\n| 01/15/2026 | 01/15/2026 | 01/15/2026 | 01/31/2026 | $54.84 | 17/31 days |\n| 02/01/2026 | 02/01/2026 | 02/01/2026 | 02/28/2026 | $100 | Full month |\n| ... | ... | ... | ... | $100 | Full months |\n\n---\n\n## Contract Value Reconciliation (TCV Check) — REQUIRED\n\nBefore finalizing the invoice schedule, you MUST reconcile totals against the contract's Total Contract Value (TCV).\n\n1) **Determine the target TCV definition** (state it explicitly in the output):\n   - If the input provides **Gross TCV / Net TCV / discount %**, treat **Net TCV as the target**.\n   - If the contract includes **usage/drawdown/overage**, clarify whether TCV **includes an estimate of usage** or is **fixed-fees-only**:\n     - If an explicit usage estimate/bucket amount is provided, include it in the target.\n     - If no estimate is provided, **exclude usage from the target** and record an item in `open_questions`.\n\n2) **Compute an internal check-sum**:\n   - `schedule_total = sum(all invoice line amounts, including discounts or negative lines)`\n   - `delta = target_tcv - schedule_total`\n\n3) **Hard rule:** the final schedule MUST satisfy `abs(delta) <= $0.01`.\n   - If not, you must **recalculate** (correct unit prices, quantities, proration day-counts, discounts, drawdown/overage logic) until it matches.\n   - If matching is impossible due to missing/ambiguous inputs, do NOT guess; put the discrepancy and the missing assumption(s) in `open_questions` and provide the closest schedule with `delta` shown.\n\n4) **Discount handling:**\n   - Apply discounts either (a) as a separate negative invoice line item, or (b) by reducing each affected charge, but ensure the **net total equals Net TCV**.\n\n5) **Output requirement:** include a `totals` block showing `target_tcv`, `schedule_total`, and `delta`.\n\n---\n\n## Output\n\nReturn JSON with complete billing schedule:\n\n```json\n{\n  \"zb_billings\": [\n    {\n      \"Invoice Date\": \"01/01/2026\",\n      \"Billing Date\": \"01/01/2026\",\n      \"Charge Name\": \"Platform License\",\n      \"Rate Plan\": \"Standard Plan\",\n      \"Product\": \"Platform\",\n      \"Billing Period Start\": \"01/01/2026\",\n      \"Billing Period End\": \"01/31/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 100,\n      \"Amount\": 100,\n      \"Currency\": \"USD\"\n    }\n  ],\n  \"totals\": {\n    \"target_tcv\": 1200,\n    \"schedule_total\": 1200,\n    \"delta\": 0\n  },\n  \"assumptions\": [\"All dates are based on calendar month boundaries\"],\n  \"open_questions\": []\n}\n```\n\n**Date formats:**\n- All dates in output: `MM/DD/YYYY`\n\n**Validation before returning:**\n1. Every charge from subscription spec has billing rows\n2. Billing periods are contiguous (no gaps)\n3. Total billed per charge = quantity × unitPrice × number of periods\n4. Proration math is correct for partial periods\n5. **TCV reconciliation: schedule_total matches target_tcv (delta ≤ $0.01)**\n\n---\n\n## Reference Documentation\n\n- Billing Timing: https://docs.zuora.com/en/zuora-billing/manage-bill-runs/billing-timing\n- Proration Overview: https://docs.zuora.com/en/zuora-billing/manage-subscriptions/proration/proration-overview\n- Partial Period Proration: https://docs.zuora.com/en/zuora-billing/manage-subscriptions/proration/calculate-total-with-partial-period-proration\n- Usage Charges: https://docs.zuora.com/en/zuora-billing/manage-product-catalog/charge-model-configurations/tiered-with-overage-charges\n- Invoice Management: https://docs.zuora.com/en/zuora-billing/manage-billing-documents/manage-invoices/invoice-management-overview\n- Bill Run Target Date: https://docs.zuora.com/en/zuora-billing/manage-bill-runs/bill-run-target-date"
        },
        {
          "role": "user",
          "content": "{\n  \"customer_name\": \"Mint Mobile\",\n  \"contract_start_date\": \"01/01/2026\",\n  \"terms_months\": 12,\n  \"transaction_currency\": \"USD\",\n  \"billing_period\": \"Monthly\",\n  \"is_allocations\": false,\n  \"use_case_description\": \"Mint Mobile wireless plan:\\n- 3 months at $15/month introductory rate\\n- 9 months at $20/month standard rate\\n- Monthly billing in advance\\n\"\n}"
        },
        {
          "role": "assistant",
          "content": "{\n  \"zb_billings\": [\n    {\n      \"Invoice Date\": \"01/01/2026\",\n      \"Billing Date\": \"01/01/2026\",\n      \"Charge Name\": \"Wireless Plan - Intro Rate\",\n      \"Rate Plan\": \"12-Month Ramp Plan\",\n      \"Product\": \"Wireless Service\",\n      \"Billing Period Start\": \"01/01/2026\",\n      \"Billing Period End\": \"01/31/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 15,\n      \"Amount\": 15,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"02/01/2026\",\n      \"Billing Date\": \"02/01/2026\",\n      \"Charge Name\": \"Wireless Plan - Intro Rate\",\n      \"Rate Plan\": \"12-Month Ramp Plan\",\n      \"Product\": \"Wireless Service\",\n      \"Billing Period Start\": \"02/01/2026\",\n      \"Billing Period End\": \"02/28/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 15,\n      \"Amount\": 15,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"03/01/2026\",\n      \"Billing Date\": \"03/01/2026\",\n      \"Charge Name\": \"Wireless Plan - Intro Rate\",\n      \"Rate Plan\": \"12-Month Ramp Plan\",\n      \"Product\": \"Wireless Service\",\n      \"Billing Period Start\": \"03/01/2026\",\n      \"Billing Period End\": \"03/31/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 15,\n      \"Amount\": 15,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"04/01/2026\",\n      \"Billing Date\": \"04/01/2026\",\n      \"Charge Name\": \"Wireless Plan - Standard Rate\",\n      \"Rate Plan\": \"12-Month Ramp Plan\",\n      \"Product\": \"Wireless Service\",\n      \"Billing Period Start\": \"04/01/2026\",\n      \"Billing Period End\": \"04/30/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 20,\n      \"Amount\": 20,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"05/01/2026\",\n      \"Billing Date\": \"05/01/2026\",\n      \"Charge Name\": \"Wireless Plan - Standard Rate\",\n      \"Rate Plan\": \"12-Month Ramp Plan\",\n      \"Product\": \"Wireless Service\",\n      \"Billing Period Start\": \"05/01/2026\",\n      \"Billing Period End\": \"05/31/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 20,\n      \"Amount\": 20,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"06/01/2026\",\n      \"Billing Date\": \"06/01/2026\",\n      \"Charge Name\": \"Wireless Plan - Standard Rate\",\n      \"Rate Plan\": \"12-Month Ramp Plan\",\n      \"Product\": \"Wireless Service\",\n      \"Billing Period Start\": \"06/01/2026\",\n      \"Billing Period End\": \"06/30/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 20,\n      \"Amount\": 20,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"07/01/2026\",\n      \"Billing Date\": \"07/01/2026\",\n      \"Charge Name\": \"Wireless Plan - Standard Rate\",\n      \"Rate Plan\": \"12-Month Ramp Plan\",\n      \"Product\": \"Wireless Service\",\n      \"Billing Period Start\": \"07/01/2026\",\n      \"Billing Period End\": \"07/31/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 20,\n      \"Amount\": 20,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"08/01/2026\",\n      \"Billing Date\": \"08/01/2026\",\n      \"Charge Name\": \"Wireless Plan - Standard Rate\",\n      \"Rate Plan\": \"12-Month Ramp Plan\",\n      \"Product\": \"Wireless Service\",\n      \"Billing Period Start\": \"08/01/2026\",\n      \"Billing Period End\": \"08/31/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 20,\n      \"Amount\": 20,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"09/01/2026\",\n      \"Billing Date\": \"09/01/2026\",\n      \"Charge Name\": \"Wireless Plan - Standard Rate\",\n      \"Rate Plan\": \"12-Month Ramp Plan\",\n      \"Product\": \"Wireless Service\",\n      \"Billing Period Start\": \"09/01/2026\",\n      \"Billing Period End\": \"09/30/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 20,\n      \"Amount\": 20,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"10/01/2026\",\n      \"Billing Date\": \"10/01/2026\",\n      \"Charge Name\": \"Wireless Plan - Standard Rate\",\n      \"Rate Plan\": \"12-Month Ramp Plan\",\n      \"Product\": \"Wireless Service\",\n      \"Billing Period Start\": \"10/01/2026\",\n      \"Billing Period End\": \"10/31/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 20,\n      \"Amount\": 20,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"11/01/2026\",\n      \"Billing Date\": \"11/01/2026\",\n      \"Charge Name\": \"Wireless Plan - Standard Rate\",\n      \"Rate Plan\": \"12-Month Ramp Plan\",\n      \"Product\": \"Wireless Service\",\n      \"Billing Period Start\": \"11/01/2026\",\n      \"Billing Period End\": \"11/30/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 20,\n      \"Amount\": 20,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"12/01/2026\",\n      \"Billing Date\": \"12/01/2026\",\n      \"Charge Name\": \"Wireless Plan - Standard Rate\",\n      \"Rate Plan\": \"12-Month Ramp Plan\",\n      \"Product\": \"Wireless Service\",\n      \"Billing Period Start\": \"12/01/2026\",\n      \"Billing Period End\": \"12/31/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 20,\n      \"Amount\": 20,\n      \"Currency\": \"USD\"\n    }\n  ],\n  \"assumptions\": [\n    \"Introductory rate applies for the first 3 months of the 12-month term\",\n    \"Standard rate applies for the remaining 9 months of the 12-month term\",\n    \"Billing is set to monthly in advance on the 1st of the month\",\n    \"Service start and end dates align with calendar month boundaries\"\n  ],\n  \"open_questions\": [],\n  \"totals\": {\n    \"target_tcv\": 225,\n    \"schedule_total\": 225,\n    \"delta\": 0\n  }\n}"
        }
      ],
      "metadata": {
        "test_case_id": "mint-mobile-intro-pricing",
        "model": "gemini-3-flash-preview",
        "run_id": "a56ca45d-6bd5-43b5-a765-248eb581ed3c",
        "created_at": "2025-12-31T03:35:13.079Z"
      }
    },
    {
      "id": "709e3e51-8c56-4feb-91db-403e7bba23e8",
      "step_name": "contracts_orders",
      "source": "evaluation_pass",
      "messages": [
        {
          "role": "system",
          "content": "You are a Zuora Revenue expert generating the RC_LINE (Contracts/Orders) table. This table is the foundation for revenue recognition—every charge becomes a line item with pricing and allocation data.\n\n---\n\n## Input Context\n\nYou will receive:\n- **Subscription spec** — charges with pricing, dates, quantities\n- **POB mapping** — template assignments for each charge (use these exactly)\n- **Contract intel** — dates and terms\n- **Allocation settings** — is_allocations flag and method\n\n---\n\n## Line Item Generation\n\n### One Line Per Charge\n\nCreate exactly ONE row for each charge from the subscription spec:\n\n| Charge in Sub Spec | → Line in Contracts/Orders |\n|-------------------|---------------------------|\n| \"Platform License - Year 1\" | Line 1: Platform License - Year 1 |\n| \"Platform License - Year 2\" | Line 2: Platform License - Year 2 |\n| \"Implementation Fee\" | Line 3: Implementation Fee |\n\n### Line Item Fields\n\nFor each line, populate:\n\n**Identity:**\n- `Line Item Num`: Sequential (1, 2, 3...)\n- `POB Name`: Charge name from subscription spec\n- `POB Template`: From POB mapping (exact match)\n- `POB IDENTIFIER`: From POB mapping (exact match)\n- `Customer Name`: From input\n- `Subscription Name`: From subscription spec\n- `Subscription Version`: 1 (for new) or increment for amendments\n\n**Charge Details:**\n- `RPC Segment`: Charge name reference\n- `RPC Type`: Recurring/OneTime/Usage\n- `Billing Period`: Month/Quarter/Annual\n- `Billing Timing`: InAdvance/InArrears\n- `Trigger Event`: From charge\n- `Terms Months`: From contract intel\n\n**Revenue Window:**\n- `Revenue Start Date`: From charge effectiveStartDate (YYYY-MM-DD format)\n- `Revenue End Date`: From charge effectiveEndDate (YYYY-MM-DD format)\n- `Sales Order Date`: Contract effective date (MM/DD/YYYY format)\n\n**Pricing:**\n- `Ordered Qty`: From charge quantity (default 1)\n- `Unit List Price`: From charge listPrice\n- `Unit Sell Price`: From charge sellPrice\n- `Ext List Price`: Qty × Unit List Price\n- `Ext Sell Price`: Qty × Unit Sell Price\n\n**Allocation (see below):**\n- `SSP Price`: Unit SSP (typically = Unit List Price unless override)\n- `Ext SSP Price`: Qty × SSP Price\n- `SSP Percent`: Line Ext SSP / Total Ext SSP × 100\n- `Ext Allocated Price`: Result of allocation calculation\n- `Allocation Eligible Flag`: true if is_allocations=true\n\n**Status:**\n- `Release Event`: From POB mapping\n- `POB Satisfied`: \"Over Time\" or \"Point In Time\" from template\n- `Lead Line`: true for first/main line, false for others\n- `Carves Adjustment`: 0 (unless explicit carve)\n- `Unreleased Revenue`: = Ext Allocated Price (initially)\n- `Released Revenue`: 0 (initially)\n\n**Classification:**\n- `Product Category`: Infer from charge/product name\n- `Product Family`: Infer from charge/product name\n\n---\n\n## Allocation Calculations\n\n### When is_allocations = false\n- `Ext Allocated Price` = `Ext Sell Price`\n- `SSP Percent` = proportional to Ext Sell Price\n- No redistribution\n\n### When is_allocations = true\n\n**Step 1: Calculate SSP totals**\n```\nTotal Ext SSP = Sum of all Ext SSP Price\nTotal Transaction Price = Sum of all Ext Sell Price\n```\n\n**Step 2: Calculate SSP percentages**\n```\nFor each line:\nSSP Percent = (Line Ext SSP Price / Total Ext SSP) × 100\n```\n\n**Step 3: Allocate transaction price**\n```\nFor each line:\nExt Allocated Price = Total Transaction Price × (SSP Percent / 100)\n```\n\n**Step 4: Validate**\n- Sum of Ext Allocated Price must equal Sum of Ext Sell Price\n\n### Ramp Deals (Override Standard Allocation)\n\nWhen charges are ramp segments (same service, different periods/prices):\n\n1. Group ramp charges together\n2. Calculate average price across all ramp periods:\n   - **Term-based**: Simple average of period prices\n   - **Volume-based**: Weighted by quantities\n3. Allocate using average price for each period\n\n**Example:** Year 1: $10,000, Year 2: $12,000, Year 3: $14,000\n- Total: $36,000 over 3 years\n- Term-based average: $12,000/year\n- Each year allocates as if $12,000 (recognition spread evenly)\n\n### Variable Consideration (VC)\n\nWhen charges have uncertain amounts (rebates, refund rights, performance bonuses):\n\n1. Only include VC to the extent a significant reversal is NOT probable\n2. Use constrained estimate for allocation\n3. When uncertainty resolves, adjust in that period\n\n### Carves (Carve-In / Carve-Out)\n\nWhen specific POBs need revenue adjustment:\n- `Carves Adjustment` reflects movement between POBs\n- Net sum of all carves = 0\n- Carve-out reduces source POB, carve-in increases destination\n\n---\n\n## Special Scenarios\n\n### Bundle Explosion\n\nWhen one billing charge creates multiple revenue lines:\n- Create separate lines for each component\n- Each component has its own POB template\n- SSP comes from bundle config\n- Allocate across components\n- Total allocated = Original bundle price\n\n### Contract Modifications\n\n**New Contract (Version 1):**\n- Fresh allocation across all lines\n\n**Amendment (Version 2+):**\n- Increment Subscription Version\n- Sales Order Date = Amendment date\n- Retrospective: Reallocate all lines\n- Prospective: Only new lines allocated, existing unchanged\n\n---\n\n## Output\n\nReturn JSON with ALL fields populated:\n\n```json\n{\n  \"zr_contracts_orders\": [\n    {\n      \"POB Name\": \"Platform License\",\n      \"POB Template\": \"BK-OT-RATABLE\",\n      \"POB Satisfied\": \"Over Time\",\n      \"Release Event\": \"Upon Booking (Full Booking Release)\",\n      \"Billing Period\": \"Month\",\n      \"Billing Timing\": \"InAdvance\",\n      \"Terms Months\": 12,\n      \"Trigger Event\": \"ContractEffective\",\n      \"Lead Line\": true,\n      \"Ordered Qty\": 1,\n      \"Line Item Num\": 1,\n      \"Subscription Name\": \"Acme Corp - Subscription\",\n      \"Subscription Version\": 1,\n      \"Sales Order Date\": \"01/01/2026\",\n      \"RPC Segment\": \"Platform License\",\n      \"RPC Type\": \"Recurring\",\n      \"Revenue Start Date\": \"2026-01-01\",\n      \"Revenue End Date\": \"2026-12-31\",\n      \"Unit List Price\": 1200,\n      \"Unit Sell Price\": 1000,\n      \"Ext List Price\": 1200,\n      \"Ext Sell Price\": 1000,\n      \"SSP Price\": 1200,\n      \"Ext SSP Price\": 1200,\n      \"SSP Percent\": 100,\n      \"Ext Allocated Price\": 1000,\n      \"Carves Adjustment\": 0,\n      \"Allocation Eligible Flag\": true,\n      \"Unreleased Revenue\": 1000,\n      \"Released Revenue\": 0,\n      \"Customer Name\": \"Acme Corp\",\n      \"POB IDENTIFIER\": \"BK-OT-RATABLE\",\n      \"Product Category\": \"Software\",\n      \"Product Family\": \"Platform\"\n    }\n  ],\n  \"assumptions\": [\"SSP equals List Price for all lines\"],\n  \"open_questions\": []\n}\n```\n\n**Critical validations before returning:**\n1. Sum(Ext Allocated Price) = Sum(Ext Sell Price)\n2. Revenue Start Date ≤ Revenue End Date for all lines\n3. Every charge from subscription spec has a corresponding line\n4. POB identifiers match the POB mapping exactly\n\n---\n\n## Reference Documentation\n\n- SSP Allocation: https://docs.zuora.com/en/zuora-revenue/advanced-revenue-operations/ssp-assignment-and-allocation\n- Ramp Deals: https://docs.zuora.com/en/zuora-revenue/day-to-day-operation/ramp-deals\n- VC Processing: https://docs.zuora.com/en/zuora-revenue/day-to-day-operation/variable-consideration-processing\n- Contract Modifications: https://docs.zuora.com/en/zuora-revenue/advanced-revenue-operations/contract-modifications\n- Bundle Explosion: https://docs.zuora.com/en/zuora-revenue/advanced-revenue-operations/bundle-explosion"
        },
        {
          "role": "user",
          "content": "{\n  \"customer_name\": \"Acme Corp\",\n  \"contract_start_date\": \"01/01/2025\",\n  \"terms_months\": 12,\n  \"transaction_currency\": \"USD\",\n  \"billing_period\": \"Monthly\",\n  \"is_allocations\": false,\n  \"use_case_description\": \"Standard SaaS subscription:\\n- $100/month for enterprise software\\n- Monthly billing in advance\\n- 12-month commitment\\n\"\n}"
        },
        {
          "role": "assistant",
          "content": "{\n  \"zr_contracts_orders\": [\n    {\n      \"POB Name\": \"Software Subscription Fee\",\n      \"POB Template\": \"BK-OT-RATABLE\",\n      \"POB Satisfied\": \"Over Time\",\n      \"Release Event\": \"Upon Booking (Full Booking Release)\",\n      \"Billing Period\": \"Month\",\n      \"Billing Timing\": \"InAdvance\",\n      \"Terms Months\": 12,\n      \"Trigger Event\": \"ContractEffective\",\n      \"Lead Line\": true,\n      \"Ordered Qty\": 1,\n      \"Line Item Num\": 1,\n      \"Subscription Name\": \"Acme Corp - Enterprise Software Subscription\",\n      \"Subscription Version\": 1,\n      \"Sales Order Date\": \"01/01/2025\",\n      \"RPC Segment\": \"Software Subscription Fee\",\n      \"RPC Type\": \"Recurring\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Unit List Price\": 1200,\n      \"Unit Sell Price\": 1200,\n      \"Ext List Price\": 1200,\n      \"Ext Sell Price\": 1200,\n      \"SSP Price\": 1200,\n      \"Ext SSP Price\": 1200,\n      \"SSP Percent\": 100,\n      \"Ext Allocated Price\": 1200,\n      \"Carves Adjustment\": 0,\n      \"Allocation Eligible Flag\": false,\n      \"Unreleased Revenue\": 1200,\n      \"Released Revenue\": 0,\n      \"Customer Name\": \"Acme Corp\",\n      \"POB IDENTIFIER\": \"BK-OT-RATABLE\",\n      \"Product Category\": \"Software\",\n      \"Product Family\": \"SaaS\"\n    }\n  ],\n  \"assumptions\": [\n    \"Allocation is disabled per user request (is_allocations = false), so Ext Allocated Price equals Ext Sell Price.\",\n    \"The $100/month recurring fee is annualized to $1200 for the 12-month term.\",\n    \"SSP is set equal to the List Price ($1200) as no specific SSP data was provided.\",\n    \"The Sales Order Date is set to the Booking Date/Service Start Date of 01/01/2025.\"\n  ],\n  \"open_questions\": []\n}"
        }
      ],
      "metadata": {
        "test_case_id": "simple-recurring-12mo",
        "model": "gemini-3-flash-preview",
        "run_id": "a56ca45d-6bd5-43b5-a765-248eb581ed3c",
        "created_at": "2025-12-31T03:36:23.325Z"
      }
    },
    {
      "id": "efc61cf5-9b5b-4661-85c9-2d71ba3643f5",
      "step_name": "billings",
      "source": "evaluation_pass",
      "messages": [
        {
          "role": "system",
          "content": "You are a Zuora Billing expert generating the complete invoice schedule. For each charge in the subscription, calculate when invoices are generated and for what amounts.\n\n---\n\n## Input Context\n\nYou will receive:\n- **Subscription spec** — charges with pricing, billing period, billing timing\n- **Contract intel** — serviceStart, serviceEnd, termMonths\n\n---\n\n## Billing Schedule Generation\n\n### By Charge Type\n\n**Recurring Charges:**\nGenerate one billing row per billing period from effectiveStartDate to effectiveEndDate.\n\n**OneTime Charges:**\nGenerate one billing row on the trigger date.\n\n**Usage Charges:**\n- If usage records provided: Calculate billing per usage period\n- If no usage: Note in open_questions that usage billing is TBD\n\n---\n\n## Billing Date Calculation\n\n### Billing Timing Rules\n\n| billingTiming | Billing Date | Service Covered |\n|---------------|--------------|-----------------|\n| InAdvance | Period Start | Start → End of period |\n| InArrears | Period End | Start → End of period |\n\n### Billing Period Lengths\n\n| billingPeriod | Duration |\n|---------------|----------|\n| Month | 1 month |\n| Quarter | 3 months |\n| Semi-Annual | 6 months |\n| Annual | 12 months |\n\n---\n\n## Step-by-Step for Recurring Charges\n\n1. **Identify billing periods:**\n   - Start at charge effectiveStartDate\n   - End at charge effectiveEndDate (or subscriptionEndDate if null)\n   - Divide into periods based on billingPeriod\n\n2. **Calculate billing dates:**\n   - InAdvance: billing date = period start date\n   - InArrears: billing date = period end date\n\n3. **Calculate amounts:**\n   - Full period: Amount = quantity × unitPrice\n   - Partial period (proration): Amount = fullAmount × (days in partial / days in full period)\n\n### Proration Rules\n\nProrate when:\n- First period starts mid-period (e.g., Jan 15 for monthly billing)\n- Last period ends mid-period (e.g., ends June 15 for monthly billing)\n- Charge effectiveDates don't align with billing period boundaries\n\n**Proration calculation:**\n```\nProrated Amount = Full Period Amount × (Actual Days / Full Period Days)\n```\n\n---\n\n## Examples\n\n### Example 1: Monthly In Advance, 12 months\n- Contract: 01/01/2026 - 12/31/2026\n- Charge: $100/month, Monthly, InAdvance\n\n| Invoice Date | Billing Date | Period Start | Period End | Amount |\n|--------------|--------------|--------------|------------|--------|\n| 01/01/2026 | 01/01/2026 | 01/01/2026 | 01/31/2026 | $100 |\n| 02/01/2026 | 02/01/2026 | 02/01/2026 | 02/28/2026 | $100 |\n| ... | ... | ... | ... | $100 |\n| 12/01/2026 | 12/01/2026 | 12/01/2026 | 12/31/2026 | $100 |\n\n### Example 2: Quarterly In Arrears\n- Contract: 01/01/2026 - 12/31/2026\n- Charge: $3,000/quarter, Quarterly, InArrears\n\n| Invoice Date | Billing Date | Period Start | Period End | Amount |\n|--------------|--------------|--------------|------------|--------|\n| 03/31/2026 | 03/31/2026 | 01/01/2026 | 03/31/2026 | $3,000 |\n| 06/30/2026 | 06/30/2026 | 04/01/2026 | 06/30/2026 | $3,000 |\n| 09/30/2026 | 09/30/2026 | 07/01/2026 | 09/30/2026 | $3,000 |\n| 12/31/2026 | 12/31/2026 | 10/01/2026 | 12/31/2026 | $3,000 |\n\n### Example 3: Annual In Advance, One-Time Fee\n- Contract: 01/01/2026 - 12/31/2026\n- Charge 1: Annual license $12,000, Annual, InAdvance\n- Charge 2: Implementation $5,000, OneTime\n\n| Invoice Date | Billing Date | Charge Name | Period Start | Period End | Amount |\n|--------------|--------------|-------------|--------------|------------|--------|\n| 01/01/2026 | 01/01/2026 | Annual License | 01/01/2026 | 12/31/2026 | $12,000 |\n| 01/01/2026 | 01/01/2026 | Implementation | 01/01/2026 | 01/01/2026 | $5,000 |\n\n### Example 4: Proration (Mid-Month Start)\n- Contract: 01/15/2026 - 12/31/2026\n- Charge: $100/month, Monthly, InAdvance\n\n| Invoice Date | Billing Date | Period Start | Period End | Amount | Notes |\n|--------------|--------------|--------------|------------|--------|-------|\n| 01/15/2026 | 01/15/2026 | 01/15/2026 | 01/31/2026 | $54.84 | 17/31 days |\n| 02/01/2026 | 02/01/2026 | 02/01/2026 | 02/28/2026 | $100 | Full month |\n| ... | ... | ... | ... | $100 | Full months |\n\n---\n\n## Contract Value Reconciliation (TCV Check) — REQUIRED\n\nBefore finalizing the invoice schedule, you MUST reconcile totals against the contract's Total Contract Value (TCV).\n\n1) **Determine the target TCV definition** (state it explicitly in the output):\n   - If the input provides **Gross TCV / Net TCV / discount %**, treat **Net TCV as the target**.\n   - If the contract includes **usage/drawdown/overage**, clarify whether TCV **includes an estimate of usage** or is **fixed-fees-only**:\n     - If an explicit usage estimate/bucket amount is provided, include it in the target.\n     - If no estimate is provided, **exclude usage from the target** and record an item in `open_questions`.\n\n2) **Compute an internal check-sum**:\n   - `schedule_total = sum(all invoice line amounts, including discounts or negative lines)`\n   - `delta = target_tcv - schedule_total`\n\n3) **Hard rule:** the final schedule MUST satisfy `abs(delta) <= $0.01`.\n   - If not, you must **recalculate** (correct unit prices, quantities, proration day-counts, discounts, drawdown/overage logic) until it matches.\n   - If matching is impossible due to missing/ambiguous inputs, do NOT guess; put the discrepancy and the missing assumption(s) in `open_questions` and provide the closest schedule with `delta` shown.\n\n4) **Discount handling:**\n   - Apply discounts either (a) as a separate negative invoice line item, or (b) by reducing each affected charge, but ensure the **net total equals Net TCV**.\n\n5) **Output requirement:** include a `totals` block showing `target_tcv`, `schedule_total`, and `delta`.\n\n---\n\n## Output\n\nReturn JSON with complete billing schedule:\n\n```json\n{\n  \"zb_billings\": [\n    {\n      \"Invoice Date\": \"01/01/2026\",\n      \"Billing Date\": \"01/01/2026\",\n      \"Charge Name\": \"Platform License\",\n      \"Rate Plan\": \"Standard Plan\",\n      \"Product\": \"Platform\",\n      \"Billing Period Start\": \"01/01/2026\",\n      \"Billing Period End\": \"01/31/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 100,\n      \"Amount\": 100,\n      \"Currency\": \"USD\"\n    }\n  ],\n  \"totals\": {\n    \"target_tcv\": 1200,\n    \"schedule_total\": 1200,\n    \"delta\": 0\n  },\n  \"assumptions\": [\"All dates are based on calendar month boundaries\"],\n  \"open_questions\": []\n}\n```\n\n**Date formats:**\n- All dates in output: `MM/DD/YYYY`\n\n**Validation before returning:**\n1. Every charge from subscription spec has billing rows\n2. Billing periods are contiguous (no gaps)\n3. Total billed per charge = quantity × unitPrice × number of periods\n4. Proration math is correct for partial periods\n5. **TCV reconciliation: schedule_total matches target_tcv (delta ≤ $0.01)**\n\n---\n\n## Reference Documentation\n\n- Billing Timing: https://docs.zuora.com/en/zuora-billing/manage-bill-runs/billing-timing\n- Proration Overview: https://docs.zuora.com/en/zuora-billing/manage-subscriptions/proration/proration-overview\n- Partial Period Proration: https://docs.zuora.com/en/zuora-billing/manage-subscriptions/proration/calculate-total-with-partial-period-proration\n- Usage Charges: https://docs.zuora.com/en/zuora-billing/manage-product-catalog/charge-model-configurations/tiered-with-overage-charges\n- Invoice Management: https://docs.zuora.com/en/zuora-billing/manage-billing-documents/manage-invoices/invoice-management-overview\n- Bill Run Target Date: https://docs.zuora.com/en/zuora-billing/manage-bill-runs/bill-run-target-date"
        },
        {
          "role": "user",
          "content": "{\n  \"customer_name\": \"Acme Corp\",\n  \"contract_start_date\": \"01/01/2025\",\n  \"terms_months\": 12,\n  \"transaction_currency\": \"USD\",\n  \"billing_period\": \"Monthly\",\n  \"is_allocations\": false,\n  \"use_case_description\": \"Standard SaaS subscription:\\n- $100/month for enterprise software\\n- Monthly billing in advance\\n- 12-month commitment\\n\"\n}"
        },
        {
          "role": "assistant",
          "content": "{\n  \"zb_billings\": [\n    {\n      \"Invoice Date\": \"01/01/2025\",\n      \"Billing Date\": \"01/01/2025\",\n      \"Charge Name\": \"Software Subscription Fee\",\n      \"Rate Plan\": \"Enterprise Monthly Plan\",\n      \"Product\": \"Enterprise Software\",\n      \"Billing Period Start\": \"01/01/2025\",\n      \"Billing Period End\": \"01/31/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 100,\n      \"Amount\": 100,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"02/01/2025\",\n      \"Billing Date\": \"02/01/2025\",\n      \"Charge Name\": \"Software Subscription Fee\",\n      \"Rate Plan\": \"Enterprise Monthly Plan\",\n      \"Product\": \"Enterprise Software\",\n      \"Billing Period Start\": \"02/01/2025\",\n      \"Billing Period End\": \"02/28/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 100,\n      \"Amount\": 100,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"03/01/2025\",\n      \"Billing Date\": \"03/01/2025\",\n      \"Charge Name\": \"Software Subscription Fee\",\n      \"Rate Plan\": \"Enterprise Monthly Plan\",\n      \"Product\": \"Enterprise Software\",\n      \"Billing Period Start\": \"03/01/2025\",\n      \"Billing Period End\": \"03/31/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 100,\n      \"Amount\": 100,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"04/01/2025\",\n      \"Billing Date\": \"04/01/2025\",\n      \"Charge Name\": \"Software Subscription Fee\",\n      \"Rate Plan\": \"Enterprise Monthly Plan\",\n      \"Product\": \"Enterprise Software\",\n      \"Billing Period Start\": \"04/01/2025\",\n      \"Billing Period End\": \"04/30/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 100,\n      \"Amount\": 100,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"05/01/2025\",\n      \"Billing Date\": \"05/01/2025\",\n      \"Charge Name\": \"Software Subscription Fee\",\n      \"Rate Plan\": \"Enterprise Monthly Plan\",\n      \"Product\": \"Enterprise Software\",\n      \"Billing Period Start\": \"05/01/2025\",\n      \"Billing Period End\": \"05/31/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 100,\n      \"Amount\": 100,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"06/01/2025\",\n      \"Billing Date\": \"06/01/2025\",\n      \"Charge Name\": \"Software Subscription Fee\",\n      \"Rate Plan\": \"Enterprise Monthly Plan\",\n      \"Product\": \"Enterprise Software\",\n      \"Billing Period Start\": \"06/01/2025\",\n      \"Billing Period End\": \"06/30/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 100,\n      \"Amount\": 100,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"07/01/2025\",\n      \"Billing Date\": \"07/01/2025\",\n      \"Charge Name\": \"Software Subscription Fee\",\n      \"Rate Plan\": \"Enterprise Monthly Plan\",\n      \"Product\": \"Enterprise Software\",\n      \"Billing Period Start\": \"07/01/2025\",\n      \"Billing Period End\": \"07/31/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 100,\n      \"Amount\": 100,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"08/01/2025\",\n      \"Billing Date\": \"08/01/2025\",\n      \"Charge Name\": \"Software Subscription Fee\",\n      \"Rate Plan\": \"Enterprise Monthly Plan\",\n      \"Product\": \"Enterprise Software\",\n      \"Billing Period Start\": \"08/01/2025\",\n      \"Billing Period End\": \"08/31/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 100,\n      \"Amount\": 100,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"09/01/2025\",\n      \"Billing Date\": \"09/01/2025\",\n      \"Charge Name\": \"Software Subscription Fee\",\n      \"Rate Plan\": \"Enterprise Monthly Plan\",\n      \"Product\": \"Enterprise Software\",\n      \"Billing Period Start\": \"09/01/2025\",\n      \"Billing Period End\": \"09/30/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 100,\n      \"Amount\": 100,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"10/01/2025\",\n      \"Billing Date\": \"10/01/2025\",\n      \"Charge Name\": \"Software Subscription Fee\",\n      \"Rate Plan\": \"Enterprise Monthly Plan\",\n      \"Product\": \"Enterprise Software\",\n      \"Billing Period Start\": \"10/01/2025\",\n      \"Billing Period End\": \"10/31/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 100,\n      \"Amount\": 100,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"11/01/2025\",\n      \"Billing Date\": \"11/01/2025\",\n      \"Charge Name\": \"Software Subscription Fee\",\n      \"Rate Plan\": \"Enterprise Monthly Plan\",\n      \"Product\": \"Enterprise Software\",\n      \"Billing Period Start\": \"11/01/2025\",\n      \"Billing Period End\": \"11/30/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 100,\n      \"Amount\": 100,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"12/01/2025\",\n      \"Billing Date\": \"12/01/2025\",\n      \"Charge Name\": \"Software Subscription Fee\",\n      \"Rate Plan\": \"Enterprise Monthly Plan\",\n      \"Product\": \"Enterprise Software\",\n      \"Billing Period Start\": \"12/01/2025\",\n      \"Billing Period End\": \"12/31/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 100,\n      \"Amount\": 100,\n      \"Currency\": \"USD\"\n    }\n  ],\n  \"assumptions\": [\n    \"Billing periods are aligned with the first day of the calendar month.\",\n    \"Target TCV is calculated as 12 months of recurring fees at $100/month.\",\n    \"Payment Term is assumed to be Net 30 per Learned Correction BL-005.\"\n  ],\n  \"open_questions\": [],\n  \"totals\": {\n    \"target_tcv\": 1200,\n    \"schedule_total\": 1200,\n    \"delta\": 0\n  }\n}"
        }
      ],
      "metadata": {
        "test_case_id": "simple-recurring-12mo",
        "model": "gemini-3-flash-preview",
        "run_id": "a56ca45d-6bd5-43b5-a765-248eb581ed3c",
        "created_at": "2025-12-31T03:36:32.430Z"
      }
    },
    {
      "id": "a11eb6b0-5f4a-4ff2-80db-c4417819d52e",
      "step_name": "contracts_orders",
      "source": "evaluation_pass",
      "messages": [
        {
          "role": "system",
          "content": "You are a Zuora Revenue expert generating the RC_LINE (Contracts/Orders) table. This table is the foundation for revenue recognition—every charge becomes a line item with pricing and allocation data.\n\n---\n\n## Input Context\n\nYou will receive:\n- **Subscription spec** — charges with pricing, dates, quantities\n- **POB mapping** — template assignments for each charge (use these exactly)\n- **Contract intel** — dates and terms\n- **Allocation settings** — is_allocations flag and method\n\n---\n\n## Line Item Generation\n\n### One Line Per Charge\n\nCreate exactly ONE row for each charge from the subscription spec:\n\n| Charge in Sub Spec | → Line in Contracts/Orders |\n|-------------------|---------------------------|\n| \"Platform License - Year 1\" | Line 1: Platform License - Year 1 |\n| \"Platform License - Year 2\" | Line 2: Platform License - Year 2 |\n| \"Implementation Fee\" | Line 3: Implementation Fee |\n\n### Line Item Fields\n\nFor each line, populate:\n\n**Identity:**\n- `Line Item Num`: Sequential (1, 2, 3...)\n- `POB Name`: Charge name from subscription spec\n- `POB Template`: From POB mapping (exact match)\n- `POB IDENTIFIER`: From POB mapping (exact match)\n- `Customer Name`: From input\n- `Subscription Name`: From subscription spec\n- `Subscription Version`: 1 (for new) or increment for amendments\n\n**Charge Details:**\n- `RPC Segment`: Charge name reference\n- `RPC Type`: Recurring/OneTime/Usage\n- `Billing Period`: Month/Quarter/Annual\n- `Billing Timing`: InAdvance/InArrears\n- `Trigger Event`: From charge\n- `Terms Months`: From contract intel\n\n**Revenue Window:**\n- `Revenue Start Date`: From charge effectiveStartDate (YYYY-MM-DD format)\n- `Revenue End Date`: From charge effectiveEndDate (YYYY-MM-DD format)\n- `Sales Order Date`: Contract effective date (MM/DD/YYYY format)\n\n**Pricing:**\n- `Ordered Qty`: From charge quantity (default 1)\n- `Unit List Price`: From charge listPrice\n- `Unit Sell Price`: From charge sellPrice\n- `Ext List Price`: Qty × Unit List Price\n- `Ext Sell Price`: Qty × Unit Sell Price\n\n**Allocation (see below):**\n- `SSP Price`: Unit SSP (typically = Unit List Price unless override)\n- `Ext SSP Price`: Qty × SSP Price\n- `SSP Percent`: Line Ext SSP / Total Ext SSP × 100\n- `Ext Allocated Price`: Result of allocation calculation\n- `Allocation Eligible Flag`: true if is_allocations=true\n\n**Status:**\n- `Release Event`: From POB mapping\n- `POB Satisfied`: \"Over Time\" or \"Point In Time\" from template\n- `Lead Line`: true for first/main line, false for others\n- `Carves Adjustment`: 0 (unless explicit carve)\n- `Unreleased Revenue`: = Ext Allocated Price (initially)\n- `Released Revenue`: 0 (initially)\n\n**Classification:**\n- `Product Category`: Infer from charge/product name\n- `Product Family`: Infer from charge/product name\n\n---\n\n## Allocation Calculations\n\n### When is_allocations = false\n- `Ext Allocated Price` = `Ext Sell Price`\n- `SSP Percent` = proportional to Ext Sell Price\n- No redistribution\n\n### When is_allocations = true\n\n**Step 1: Calculate SSP totals**\n```\nTotal Ext SSP = Sum of all Ext SSP Price\nTotal Transaction Price = Sum of all Ext Sell Price\n```\n\n**Step 2: Calculate SSP percentages**\n```\nFor each line:\nSSP Percent = (Line Ext SSP Price / Total Ext SSP) × 100\n```\n\n**Step 3: Allocate transaction price**\n```\nFor each line:\nExt Allocated Price = Total Transaction Price × (SSP Percent / 100)\n```\n\n**Step 4: Validate**\n- Sum of Ext Allocated Price must equal Sum of Ext Sell Price\n\n### Ramp Deals (Override Standard Allocation)\n\nWhen charges are ramp segments (same service, different periods/prices):\n\n1. Group ramp charges together\n2. Calculate average price across all ramp periods:\n   - **Term-based**: Simple average of period prices\n   - **Volume-based**: Weighted by quantities\n3. Allocate using average price for each period\n\n**Example:** Year 1: $10,000, Year 2: $12,000, Year 3: $14,000\n- Total: $36,000 over 3 years\n- Term-based average: $12,000/year\n- Each year allocates as if $12,000 (recognition spread evenly)\n\n### Variable Consideration (VC)\n\nWhen charges have uncertain amounts (rebates, refund rights, performance bonuses):\n\n1. Only include VC to the extent a significant reversal is NOT probable\n2. Use constrained estimate for allocation\n3. When uncertainty resolves, adjust in that period\n\n### Carves (Carve-In / Carve-Out)\n\nWhen specific POBs need revenue adjustment:\n- `Carves Adjustment` reflects movement between POBs\n- Net sum of all carves = 0\n- Carve-out reduces source POB, carve-in increases destination\n\n---\n\n## Special Scenarios\n\n### Bundle Explosion\n\nWhen one billing charge creates multiple revenue lines:\n- Create separate lines for each component\n- Each component has its own POB template\n- SSP comes from bundle config\n- Allocate across components\n- Total allocated = Original bundle price\n\n### Contract Modifications\n\n**New Contract (Version 1):**\n- Fresh allocation across all lines\n\n**Amendment (Version 2+):**\n- Increment Subscription Version\n- Sales Order Date = Amendment date\n- Retrospective: Reallocate all lines\n- Prospective: Only new lines allocated, existing unchanged\n\n---\n\n## Output\n\nReturn JSON with ALL fields populated:\n\n```json\n{\n  \"zr_contracts_orders\": [\n    {\n      \"POB Name\": \"Platform License\",\n      \"POB Template\": \"BK-OT-RATABLE\",\n      \"POB Satisfied\": \"Over Time\",\n      \"Release Event\": \"Upon Booking (Full Booking Release)\",\n      \"Billing Period\": \"Month\",\n      \"Billing Timing\": \"InAdvance\",\n      \"Terms Months\": 12,\n      \"Trigger Event\": \"ContractEffective\",\n      \"Lead Line\": true,\n      \"Ordered Qty\": 1,\n      \"Line Item Num\": 1,\n      \"Subscription Name\": \"Acme Corp - Subscription\",\n      \"Subscription Version\": 1,\n      \"Sales Order Date\": \"01/01/2026\",\n      \"RPC Segment\": \"Platform License\",\n      \"RPC Type\": \"Recurring\",\n      \"Revenue Start Date\": \"2026-01-01\",\n      \"Revenue End Date\": \"2026-12-31\",\n      \"Unit List Price\": 1200,\n      \"Unit Sell Price\": 1000,\n      \"Ext List Price\": 1200,\n      \"Ext Sell Price\": 1000,\n      \"SSP Price\": 1200,\n      \"Ext SSP Price\": 1200,\n      \"SSP Percent\": 100,\n      \"Ext Allocated Price\": 1000,\n      \"Carves Adjustment\": 0,\n      \"Allocation Eligible Flag\": true,\n      \"Unreleased Revenue\": 1000,\n      \"Released Revenue\": 0,\n      \"Customer Name\": \"Acme Corp\",\n      \"POB IDENTIFIER\": \"BK-OT-RATABLE\",\n      \"Product Category\": \"Software\",\n      \"Product Family\": \"Platform\"\n    }\n  ],\n  \"assumptions\": [\"SSP equals List Price for all lines\"],\n  \"open_questions\": []\n}\n```\n\n**Critical validations before returning:**\n1. Sum(Ext Allocated Price) = Sum(Ext Sell Price)\n2. Revenue Start Date ≤ Revenue End Date for all lines\n3. Every charge from subscription spec has a corresponding line\n4. POB identifiers match the POB mapping exactly\n\n---\n\n## Reference Documentation\n\n- SSP Allocation: https://docs.zuora.com/en/zuora-revenue/advanced-revenue-operations/ssp-assignment-and-allocation\n- Ramp Deals: https://docs.zuora.com/en/zuora-revenue/day-to-day-operation/ramp-deals\n- VC Processing: https://docs.zuora.com/en/zuora-revenue/day-to-day-operation/variable-consideration-processing\n- Contract Modifications: https://docs.zuora.com/en/zuora-revenue/advanced-revenue-operations/contract-modifications\n- Bundle Explosion: https://docs.zuora.com/en/zuora-revenue/advanced-revenue-operations/bundle-explosion"
        },
        {
          "role": "user",
          "content": "{\n  \"customer_name\": \"TechGiant Inc\",\n  \"contract_start_date\": \"01/01/2025\",\n  \"terms_months\": 24,\n  \"transaction_currency\": \"USD\",\n  \"billing_period\": \"Monthly\",\n  \"is_allocations\": false,\n  \"use_case_description\": \"Enterprise platform subscription with annual ramp:\\n- Year 1: $1000/month\\n- Year 2: $1200/month (20% increase)\\n- Monthly billing in advance\\n\"\n}"
        },
        {
          "role": "assistant",
          "content": "{\n  \"zr_contracts_orders\": [\n    {\n      \"POB Name\": \"Platform Subscription - Year 1\",\n      \"POB Template\": \"BK-OT-RATABLE\",\n      \"POB Satisfied\": \"Over Time\",\n      \"Release Event\": \"Upon Booking (Full Booking Release)\",\n      \"Billing Period\": \"Month\",\n      \"Billing Timing\": \"InAdvance\",\n      \"Terms Months\": 24,\n      \"Trigger Event\": \"ContractEffective\",\n      \"Lead Line\": true,\n      \"Ordered Qty\": 1,\n      \"Line Item Num\": 1,\n      \"Subscription Name\": \"TechGiant Inc - Enterprise Platform\",\n      \"Subscription Version\": 1,\n      \"Sales Order Date\": \"01/01/2025\",\n      \"RPC Segment\": \"Platform Subscription - Year 1\",\n      \"RPC Type\": \"Recurring\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Unit List Price\": 12000,\n      \"Unit Sell Price\": 12000,\n      \"Ext List Price\": 12000,\n      \"Ext Sell Price\": 12000,\n      \"SSP Price\": 12000,\n      \"Ext SSP Price\": 12000,\n      \"SSP Percent\": 45.45,\n      \"Ext Allocated Price\": 12000,\n      \"Carves Adjustment\": 0,\n      \"Allocation Eligible Flag\": false,\n      \"Unreleased Revenue\": 12000,\n      \"Released Revenue\": 0,\n      \"Customer Name\": \"TechGiant Inc\",\n      \"POB IDENTIFIER\": \"BK-OT-RATABLE\",\n      \"Product Category\": \"Software\",\n      \"Product Family\": \"Platform\"\n    },\n    {\n      \"POB Name\": \"Platform Subscription - Year 2\",\n      \"POB Template\": \"BK-OT-RATABLE\",\n      \"POB Satisfied\": \"Over Time\",\n      \"Release Event\": \"Upon Booking (Full Booking Release)\",\n      \"Billing Period\": \"Month\",\n      \"Billing Timing\": \"InAdvance\",\n      \"Terms Months\": 24,\n      \"Trigger Event\": \"ContractEffective\",\n      \"Lead Line\": false,\n      \"Ordered Qty\": 1,\n      \"Line Item Num\": 2,\n      \"Subscription Name\": \"TechGiant Inc - Enterprise Platform\",\n      \"Subscription Version\": 1,\n      \"Sales Order Date\": \"01/01/2025\",\n      \"RPC Segment\": \"Platform Subscription - Year 2\",\n      \"RPC Type\": \"Recurring\",\n      \"Revenue Start Date\": \"2026-01-01\",\n      \"Revenue End Date\": \"2026-12-31\",\n      \"Unit List Price\": 14400,\n      \"Unit Sell Price\": 14400,\n      \"Ext List Price\": 14400,\n      \"Ext Sell Price\": 14400,\n      \"SSP Price\": 14400,\n      \"Ext SSP Price\": 14400,\n      \"SSP Percent\": 54.55,\n      \"Ext Allocated Price\": 14400,\n      \"Carves Adjustment\": 0,\n      \"Allocation Eligible Flag\": false,\n      \"Unreleased Revenue\": 14400,\n      \"Released Revenue\": 0,\n      \"Customer Name\": \"TechGiant Inc\",\n      \"POB IDENTIFIER\": \"BK-OT-RATABLE\",\n      \"Product Category\": \"Software\",\n      \"Product Family\": \"Platform\"\n    }\n  ],\n  \"assumptions\": [\n    \"Allocations were disabled per request, so Ext Allocated Price equals Ext Sell Price for each line.\",\n    \"Unit List and Sell prices represent the annual total for each ramp segment (12 months x monthly rate).\",\n    \"SSP is assumed to equal List Price as no specific SSP data was provided.\",\n    \"SSP Percent is calculated based on the relative weight of each line's SSP to the total contract SSP ($26,400).\"\n  ],\n  \"open_questions\": [\n    \"Confirm if the ramp should be treated as a single POB with a weighted average price for smoothed revenue recognition, as 'Allocations: No' currently results in revenue stepping up in Year 2.\"\n  ]\n}"
        }
      ],
      "metadata": {
        "test_case_id": "annual-ramp-2year",
        "model": "gemini-3-flash-preview",
        "run_id": "a56ca45d-6bd5-43b5-a765-248eb581ed3c",
        "created_at": "2025-12-31T03:38:23.989Z"
      }
    },
    {
      "id": "195fc950-aedf-46c3-8cb2-21cb99eb48a0",
      "step_name": "billings",
      "source": "evaluation_pass",
      "messages": [
        {
          "role": "system",
          "content": "You are a Zuora Billing expert generating the complete invoice schedule. For each charge in the subscription, calculate when invoices are generated and for what amounts.\n\n---\n\n## Input Context\n\nYou will receive:\n- **Subscription spec** — charges with pricing, billing period, billing timing\n- **Contract intel** — serviceStart, serviceEnd, termMonths\n\n---\n\n## Billing Schedule Generation\n\n### By Charge Type\n\n**Recurring Charges:**\nGenerate one billing row per billing period from effectiveStartDate to effectiveEndDate.\n\n**OneTime Charges:**\nGenerate one billing row on the trigger date.\n\n**Usage Charges:**\n- If usage records provided: Calculate billing per usage period\n- If no usage: Note in open_questions that usage billing is TBD\n\n---\n\n## Billing Date Calculation\n\n### Billing Timing Rules\n\n| billingTiming | Billing Date | Service Covered |\n|---------------|--------------|-----------------|\n| InAdvance | Period Start | Start → End of period |\n| InArrears | Period End | Start → End of period |\n\n### Billing Period Lengths\n\n| billingPeriod | Duration |\n|---------------|----------|\n| Month | 1 month |\n| Quarter | 3 months |\n| Semi-Annual | 6 months |\n| Annual | 12 months |\n\n---\n\n## Step-by-Step for Recurring Charges\n\n1. **Identify billing periods:**\n   - Start at charge effectiveStartDate\n   - End at charge effectiveEndDate (or subscriptionEndDate if null)\n   - Divide into periods based on billingPeriod\n\n2. **Calculate billing dates:**\n   - InAdvance: billing date = period start date\n   - InArrears: billing date = period end date\n\n3. **Calculate amounts:**\n   - Full period: Amount = quantity × unitPrice\n   - Partial period (proration): Amount = fullAmount × (days in partial / days in full period)\n\n### Proration Rules\n\nProrate when:\n- First period starts mid-period (e.g., Jan 15 for monthly billing)\n- Last period ends mid-period (e.g., ends June 15 for monthly billing)\n- Charge effectiveDates don't align with billing period boundaries\n\n**Proration calculation:**\n```\nProrated Amount = Full Period Amount × (Actual Days / Full Period Days)\n```\n\n---\n\n## Examples\n\n### Example 1: Monthly In Advance, 12 months\n- Contract: 01/01/2026 - 12/31/2026\n- Charge: $100/month, Monthly, InAdvance\n\n| Invoice Date | Billing Date | Period Start | Period End | Amount |\n|--------------|--------------|--------------|------------|--------|\n| 01/01/2026 | 01/01/2026 | 01/01/2026 | 01/31/2026 | $100 |\n| 02/01/2026 | 02/01/2026 | 02/01/2026 | 02/28/2026 | $100 |\n| ... | ... | ... | ... | $100 |\n| 12/01/2026 | 12/01/2026 | 12/01/2026 | 12/31/2026 | $100 |\n\n### Example 2: Quarterly In Arrears\n- Contract: 01/01/2026 - 12/31/2026\n- Charge: $3,000/quarter, Quarterly, InArrears\n\n| Invoice Date | Billing Date | Period Start | Period End | Amount |\n|--------------|--------------|--------------|------------|--------|\n| 03/31/2026 | 03/31/2026 | 01/01/2026 | 03/31/2026 | $3,000 |\n| 06/30/2026 | 06/30/2026 | 04/01/2026 | 06/30/2026 | $3,000 |\n| 09/30/2026 | 09/30/2026 | 07/01/2026 | 09/30/2026 | $3,000 |\n| 12/31/2026 | 12/31/2026 | 10/01/2026 | 12/31/2026 | $3,000 |\n\n### Example 3: Annual In Advance, One-Time Fee\n- Contract: 01/01/2026 - 12/31/2026\n- Charge 1: Annual license $12,000, Annual, InAdvance\n- Charge 2: Implementation $5,000, OneTime\n\n| Invoice Date | Billing Date | Charge Name | Period Start | Period End | Amount |\n|--------------|--------------|-------------|--------------|------------|--------|\n| 01/01/2026 | 01/01/2026 | Annual License | 01/01/2026 | 12/31/2026 | $12,000 |\n| 01/01/2026 | 01/01/2026 | Implementation | 01/01/2026 | 01/01/2026 | $5,000 |\n\n### Example 4: Proration (Mid-Month Start)\n- Contract: 01/15/2026 - 12/31/2026\n- Charge: $100/month, Monthly, InAdvance\n\n| Invoice Date | Billing Date | Period Start | Period End | Amount | Notes |\n|--------------|--------------|--------------|------------|--------|-------|\n| 01/15/2026 | 01/15/2026 | 01/15/2026 | 01/31/2026 | $54.84 | 17/31 days |\n| 02/01/2026 | 02/01/2026 | 02/01/2026 | 02/28/2026 | $100 | Full month |\n| ... | ... | ... | ... | $100 | Full months |\n\n---\n\n## Contract Value Reconciliation (TCV Check) — REQUIRED\n\nBefore finalizing the invoice schedule, you MUST reconcile totals against the contract's Total Contract Value (TCV).\n\n1) **Determine the target TCV definition** (state it explicitly in the output):\n   - If the input provides **Gross TCV / Net TCV / discount %**, treat **Net TCV as the target**.\n   - If the contract includes **usage/drawdown/overage**, clarify whether TCV **includes an estimate of usage** or is **fixed-fees-only**:\n     - If an explicit usage estimate/bucket amount is provided, include it in the target.\n     - If no estimate is provided, **exclude usage from the target** and record an item in `open_questions`.\n\n2) **Compute an internal check-sum**:\n   - `schedule_total = sum(all invoice line amounts, including discounts or negative lines)`\n   - `delta = target_tcv - schedule_total`\n\n3) **Hard rule:** the final schedule MUST satisfy `abs(delta) <= $0.01`.\n   - If not, you must **recalculate** (correct unit prices, quantities, proration day-counts, discounts, drawdown/overage logic) until it matches.\n   - If matching is impossible due to missing/ambiguous inputs, do NOT guess; put the discrepancy and the missing assumption(s) in `open_questions` and provide the closest schedule with `delta` shown.\n\n4) **Discount handling:**\n   - Apply discounts either (a) as a separate negative invoice line item, or (b) by reducing each affected charge, but ensure the **net total equals Net TCV**.\n\n5) **Output requirement:** include a `totals` block showing `target_tcv`, `schedule_total`, and `delta`.\n\n---\n\n## Output\n\nReturn JSON with complete billing schedule:\n\n```json\n{\n  \"zb_billings\": [\n    {\n      \"Invoice Date\": \"01/01/2026\",\n      \"Billing Date\": \"01/01/2026\",\n      \"Charge Name\": \"Platform License\",\n      \"Rate Plan\": \"Standard Plan\",\n      \"Product\": \"Platform\",\n      \"Billing Period Start\": \"01/01/2026\",\n      \"Billing Period End\": \"01/31/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 100,\n      \"Amount\": 100,\n      \"Currency\": \"USD\"\n    }\n  ],\n  \"totals\": {\n    \"target_tcv\": 1200,\n    \"schedule_total\": 1200,\n    \"delta\": 0\n  },\n  \"assumptions\": [\"All dates are based on calendar month boundaries\"],\n  \"open_questions\": []\n}\n```\n\n**Date formats:**\n- All dates in output: `MM/DD/YYYY`\n\n**Validation before returning:**\n1. Every charge from subscription spec has billing rows\n2. Billing periods are contiguous (no gaps)\n3. Total billed per charge = quantity × unitPrice × number of periods\n4. Proration math is correct for partial periods\n5. **TCV reconciliation: schedule_total matches target_tcv (delta ≤ $0.01)**\n\n---\n\n## Reference Documentation\n\n- Billing Timing: https://docs.zuora.com/en/zuora-billing/manage-bill-runs/billing-timing\n- Proration Overview: https://docs.zuora.com/en/zuora-billing/manage-subscriptions/proration/proration-overview\n- Partial Period Proration: https://docs.zuora.com/en/zuora-billing/manage-subscriptions/proration/calculate-total-with-partial-period-proration\n- Usage Charges: https://docs.zuora.com/en/zuora-billing/manage-product-catalog/charge-model-configurations/tiered-with-overage-charges\n- Invoice Management: https://docs.zuora.com/en/zuora-billing/manage-billing-documents/manage-invoices/invoice-management-overview\n- Bill Run Target Date: https://docs.zuora.com/en/zuora-billing/manage-bill-runs/bill-run-target-date"
        },
        {
          "role": "user",
          "content": "{\n  \"customer_name\": \"TechGiant Inc\",\n  \"contract_start_date\": \"01/01/2025\",\n  \"terms_months\": 24,\n  \"transaction_currency\": \"USD\",\n  \"billing_period\": \"Monthly\",\n  \"is_allocations\": false,\n  \"use_case_description\": \"Enterprise platform subscription with annual ramp:\\n- Year 1: $1000/month\\n- Year 2: $1200/month (20% increase)\\n- Monthly billing in advance\\n\"\n}"
        },
        {
          "role": "assistant",
          "content": "{\n  \"zb_billings\": [\n    {\n      \"Invoice Date\": \"01/01/2025\",\n      \"Billing Date\": \"01/01/2025\",\n      \"Charge Name\": \"Platform Subscription - Year 1\",\n      \"Rate Plan\": \"Enterprise Platform Annual Ramp\",\n      \"Product\": \"Enterprise Platform\",\n      \"Billing Period Start\": \"01/01/2025\",\n      \"Billing Period End\": \"01/31/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 1000,\n      \"Amount\": 1000,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"02/01/2025\",\n      \"Billing Date\": \"02/01/2025\",\n      \"Charge Name\": \"Platform Subscription - Year 1\",\n      \"Rate Plan\": \"Enterprise Platform Annual Ramp\",\n      \"Product\": \"Enterprise Platform\",\n      \"Billing Period Start\": \"02/01/2025\",\n      \"Billing Period End\": \"02/28/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 1000,\n      \"Amount\": 1000,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"03/01/2025\",\n      \"Billing Date\": \"03/01/2025\",\n      \"Charge Name\": \"Platform Subscription - Year 1\",\n      \"Rate Plan\": \"Enterprise Platform Annual Ramp\",\n      \"Product\": \"Enterprise Platform\",\n      \"Billing Period Start\": \"03/01/2025\",\n      \"Billing Period End\": \"03/31/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 1000,\n      \"Amount\": 1000,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"04/01/2025\",\n      \"Billing Date\": \"04/01/2025\",\n      \"Charge Name\": \"Platform Subscription - Year 1\",\n      \"Rate Plan\": \"Enterprise Platform Annual Ramp\",\n      \"Product\": \"Enterprise Platform\",\n      \"Billing Period Start\": \"04/01/2025\",\n      \"Billing Period End\": \"04/30/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 1000,\n      \"Amount\": 1000,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"05/01/2025\",\n      \"Billing Date\": \"05/01/2025\",\n      \"Charge Name\": \"Platform Subscription - Year 1\",\n      \"Rate Plan\": \"Enterprise Platform Annual Ramp\",\n      \"Product\": \"Enterprise Platform\",\n      \"Billing Period Start\": \"05/01/2025\",\n      \"Billing Period End\": \"05/31/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 1000,\n      \"Amount\": 1000,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"06/01/2025\",\n      \"Billing Date\": \"06/01/2025\",\n      \"Charge Name\": \"Platform Subscription - Year 1\",\n      \"Rate Plan\": \"Enterprise Platform Annual Ramp\",\n      \"Product\": \"Enterprise Platform\",\n      \"Billing Period Start\": \"06/01/2025\",\n      \"Billing Period End\": \"06/30/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 1000,\n      \"Amount\": 1000,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"07/01/2025\",\n      \"Billing Date\": \"07/01/2025\",\n      \"Charge Name\": \"Platform Subscription - Year 1\",\n      \"Rate Plan\": \"Enterprise Platform Annual Ramp\",\n      \"Product\": \"Enterprise Platform\",\n      \"Billing Period Start\": \"07/01/2025\",\n      \"Billing Period End\": \"07/31/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 1000,\n      \"Amount\": 1000,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"08/01/2025\",\n      \"Billing Date\": \"08/01/2025\",\n      \"Charge Name\": \"Platform Subscription - Year 1\",\n      \"Rate Plan\": \"Enterprise Platform Annual Ramp\",\n      \"Product\": \"Enterprise Platform\",\n      \"Billing Period Start\": \"08/01/2025\",\n      \"Billing Period End\": \"08/31/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 1000,\n      \"Amount\": 1000,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"09/01/2025\",\n      \"Billing Date\": \"09/01/2025\",\n      \"Charge Name\": \"Platform Subscription - Year 1\",\n      \"Rate Plan\": \"Enterprise Platform Annual Ramp\",\n      \"Product\": \"Enterprise Platform\",\n      \"Billing Period Start\": \"09/01/2025\",\n      \"Billing Period End\": \"09/30/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 1000,\n      \"Amount\": 1000,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"10/01/2025\",\n      \"Billing Date\": \"10/01/2025\",\n      \"Charge Name\": \"Platform Subscription - Year 1\",\n      \"Rate Plan\": \"Enterprise Platform Annual Ramp\",\n      \"Product\": \"Enterprise Platform\",\n      \"Billing Period Start\": \"10/01/2025\",\n      \"Billing Period End\": \"10/31/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 1000,\n      \"Amount\": 1000,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"11/01/2025\",\n      \"Billing Date\": \"11/01/2025\",\n      \"Charge Name\": \"Platform Subscription - Year 1\",\n      \"Rate Plan\": \"Enterprise Platform Annual Ramp\",\n      \"Product\": \"Enterprise Platform\",\n      \"Billing Period Start\": \"11/01/2025\",\n      \"Billing Period End\": \"11/30/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 1000,\n      \"Amount\": 1000,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"12/01/2025\",\n      \"Billing Date\": \"12/01/2025\",\n      \"Charge Name\": \"Platform Subscription - Year 1\",\n      \"Rate Plan\": \"Enterprise Platform Annual Ramp\",\n      \"Product\": \"Enterprise Platform\",\n      \"Billing Period Start\": \"12/01/2025\",\n      \"Billing Period End\": \"12/31/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 1000,\n      \"Amount\": 1000,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"01/01/2026\",\n      \"Billing Date\": \"01/01/2026\",\n      \"Charge Name\": \"Platform Subscription - Year 2\",\n      \"Rate Plan\": \"Enterprise Platform Annual Ramp\",\n      \"Product\": \"Enterprise Platform\",\n      \"Billing Period Start\": \"01/01/2026\",\n      \"Billing Period End\": \"01/31/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 1200,\n      \"Amount\": 1200,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"02/01/2026\",\n      \"Billing Date\": \"02/01/2026\",\n      \"Charge Name\": \"Platform Subscription - Year 2\",\n      \"Rate Plan\": \"Enterprise Platform Annual Ramp\",\n      \"Product\": \"Enterprise Platform\",\n      \"Billing Period Start\": \"02/01/2026\",\n      \"Billing Period End\": \"02/28/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 1200,\n      \"Amount\": 1200,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"03/01/2026\",\n      \"Billing Date\": \"03/01/2026\",\n      \"Charge Name\": \"Platform Subscription - Year 2\",\n      \"Rate Plan\": \"Enterprise Platform Annual Ramp\",\n      \"Product\": \"Enterprise Platform\",\n      \"Billing Period Start\": \"03/01/2026\",\n      \"Billing Period End\": \"03/31/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 1200,\n      \"Amount\": 1200,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"04/01/2026\",\n      \"Billing Date\": \"04/01/2026\",\n      \"Charge Name\": \"Platform Subscription - Year 2\",\n      \"Rate Plan\": \"Enterprise Platform Annual Ramp\",\n      \"Product\": \"Enterprise Platform\",\n      \"Billing Period Start\": \"04/01/2026\",\n      \"Billing Period End\": \"04/30/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 1200,\n      \"Amount\": 1200,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"05/01/2026\",\n      \"Billing Date\": \"05/01/2026\",\n      \"Charge Name\": \"Platform Subscription - Year 2\",\n      \"Rate Plan\": \"Enterprise Platform Annual Ramp\",\n      \"Product\": \"Enterprise Platform\",\n      \"Billing Period Start\": \"05/01/2026\",\n      \"Billing Period End\": \"05/31/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 1200,\n      \"Amount\": 1200,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"06/01/2026\",\n      \"Billing Date\": \"06/01/2026\",\n      \"Charge Name\": \"Platform Subscription - Year 2\",\n      \"Rate Plan\": \"Enterprise Platform Annual Ramp\",\n      \"Product\": \"Enterprise Platform\",\n      \"Billing Period Start\": \"06/01/2026\",\n      \"Billing Period End\": \"06/30/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 1200,\n      \"Amount\": 1200,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"07/01/2026\",\n      \"Billing Date\": \"07/01/2026\",\n      \"Charge Name\": \"Platform Subscription - Year 2\",\n      \"Rate Plan\": \"Enterprise Platform Annual Ramp\",\n      \"Product\": \"Enterprise Platform\",\n      \"Billing Period Start\": \"07/01/2026\",\n      \"Billing Period End\": \"07/31/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 1200,\n      \"Amount\": 1200,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"08/01/2026\",\n      \"Billing Date\": \"08/01/2026\",\n      \"Charge Name\": \"Platform Subscription - Year 2\",\n      \"Rate Plan\": \"Enterprise Platform Annual Ramp\",\n      \"Product\": \"Enterprise Platform\",\n      \"Billing Period Start\": \"08/01/2026\",\n      \"Billing Period End\": \"08/31/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 1200,\n      \"Amount\": 1200,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"09/01/2026\",\n      \"Billing Date\": \"09/01/2026\",\n      \"Charge Name\": \"Platform Subscription - Year 2\",\n      \"Rate Plan\": \"Enterprise Platform Annual Ramp\",\n      \"Product\": \"Enterprise Platform\",\n      \"Billing Period Start\": \"09/01/2026\",\n      \"Billing Period End\": \"09/30/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 1200,\n      \"Amount\": 1200,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"10/01/2026\",\n      \"Billing Date\": \"10/01/2026\",\n      \"Charge Name\": \"Platform Subscription - Year 2\",\n      \"Rate Plan\": \"Enterprise Platform Annual Ramp\",\n      \"Product\": \"Enterprise Platform\",\n      \"Billing Period Start\": \"10/01/2026\",\n      \"Billing Period End\": \"10/31/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 1200,\n      \"Amount\": 1200,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"11/01/2026\",\n      \"Billing Date\": \"11/01/2026\",\n      \"Charge Name\": \"Platform Subscription - Year 2\",\n      \"Rate Plan\": \"Enterprise Platform Annual Ramp\",\n      \"Product\": \"Enterprise Platform\",\n      \"Billing Period Start\": \"11/01/2026\",\n      \"Billing Period End\": \"11/30/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 1200,\n      \"Amount\": 1200,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"12/01/2026\",\n      \"Billing Date\": \"12/01/2026\",\n      \"Charge Name\": \"Platform Subscription - Year 2\",\n      \"Rate Plan\": \"Enterprise Platform Annual Ramp\",\n      \"Product\": \"Enterprise Platform\",\n      \"Billing Period Start\": \"12/01/2026\",\n      \"Billing Period End\": \"12/31/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 1200,\n      \"Amount\": 1200,\n      \"Currency\": \"USD\"\n    }\n  ],\n  \"assumptions\": [\n    \"Service Start Date is 01/01/2025 and Service End Date is 12/31/2026.\",\n    \"Year 1 charge is active from 01/01/2025 to 12/31/2025.\",\n    \"Year 2 charge is active from 01/01/2026 to 12/31/2026.\",\n    \"Billing timing is 'In Advance', so the Invoice Date and Billing Date match the Period Start Date.\",\n    \"Billing period is 'Month', and the contract aligns with calendar months, so no proration is required.\"\n  ],\n  \"open_questions\": [],\n  \"totals\": {\n    \"target_tcv\": 26400,\n    \"schedule_total\": 26400,\n    \"delta\": 0\n  }\n}"
        }
      ],
      "metadata": {
        "test_case_id": "annual-ramp-2year",
        "model": "gemini-3-flash-preview",
        "run_id": "a56ca45d-6bd5-43b5-a765-248eb581ed3c",
        "created_at": "2025-12-31T03:38:29.430Z"
      }
    },
    {
      "id": "52d37234-767d-4933-977c-a51cc9f6452e",
      "step_name": "billings",
      "source": "evaluation_pass",
      "messages": [
        {
          "role": "system",
          "content": "You are a Zuora Billing expert generating the complete invoice schedule. For each charge in the subscription, calculate when invoices are generated and for what amounts.\n\n---\n\n## Input Context\n\nYou will receive:\n- **Subscription spec** — charges with pricing, billing period, billing timing\n- **Contract intel** — serviceStart, serviceEnd, termMonths\n\n---\n\n## Billing Schedule Generation\n\n### By Charge Type\n\n**Recurring Charges:**\nGenerate one billing row per billing period from effectiveStartDate to effectiveEndDate.\n\n**OneTime Charges:**\nGenerate one billing row on the trigger date.\n\n**Usage Charges:**\n- If usage records provided: Calculate billing per usage period\n- If no usage: Note in open_questions that usage billing is TBD\n\n---\n\n## Billing Date Calculation\n\n### Billing Timing Rules\n\n| billingTiming | Billing Date | Service Covered |\n|---------------|--------------|-----------------|\n| InAdvance | Period Start | Start → End of period |\n| InArrears | Period End | Start → End of period |\n\n### Billing Period Lengths\n\n| billingPeriod | Duration |\n|---------------|----------|\n| Month | 1 month |\n| Quarter | 3 months |\n| Semi-Annual | 6 months |\n| Annual | 12 months |\n\n---\n\n## Step-by-Step for Recurring Charges\n\n1. **Identify billing periods:**\n   - Start at charge effectiveStartDate\n   - End at charge effectiveEndDate (or subscriptionEndDate if null)\n   - Divide into periods based on billingPeriod\n\n2. **Calculate billing dates:**\n   - InAdvance: billing date = period start date\n   - InArrears: billing date = period end date\n\n3. **Calculate amounts:**\n   - Full period: Amount = quantity × unitPrice\n   - Partial period (proration): Amount = fullAmount × (days in partial / days in full period)\n\n### Proration Rules\n\nProrate when:\n- First period starts mid-period (e.g., Jan 15 for monthly billing)\n- Last period ends mid-period (e.g., ends June 15 for monthly billing)\n- Charge effectiveDates don't align with billing period boundaries\n\n**Proration calculation:**\n```\nProrated Amount = Full Period Amount × (Actual Days / Full Period Days)\n```\n\n---\n\n## Examples\n\n### Example 1: Monthly In Advance, 12 months\n- Contract: 01/01/2026 - 12/31/2026\n- Charge: $100/month, Monthly, InAdvance\n\n| Invoice Date | Billing Date | Period Start | Period End | Amount |\n|--------------|--------------|--------------|------------|--------|\n| 01/01/2026 | 01/01/2026 | 01/01/2026 | 01/31/2026 | $100 |\n| 02/01/2026 | 02/01/2026 | 02/01/2026 | 02/28/2026 | $100 |\n| ... | ... | ... | ... | $100 |\n| 12/01/2026 | 12/01/2026 | 12/01/2026 | 12/31/2026 | $100 |\n\n### Example 2: Quarterly In Arrears\n- Contract: 01/01/2026 - 12/31/2026\n- Charge: $3,000/quarter, Quarterly, InArrears\n\n| Invoice Date | Billing Date | Period Start | Period End | Amount |\n|--------------|--------------|--------------|------------|--------|\n| 03/31/2026 | 03/31/2026 | 01/01/2026 | 03/31/2026 | $3,000 |\n| 06/30/2026 | 06/30/2026 | 04/01/2026 | 06/30/2026 | $3,000 |\n| 09/30/2026 | 09/30/2026 | 07/01/2026 | 09/30/2026 | $3,000 |\n| 12/31/2026 | 12/31/2026 | 10/01/2026 | 12/31/2026 | $3,000 |\n\n### Example 3: Annual In Advance, One-Time Fee\n- Contract: 01/01/2026 - 12/31/2026\n- Charge 1: Annual license $12,000, Annual, InAdvance\n- Charge 2: Implementation $5,000, OneTime\n\n| Invoice Date | Billing Date | Charge Name | Period Start | Period End | Amount |\n|--------------|--------------|-------------|--------------|------------|--------|\n| 01/01/2026 | 01/01/2026 | Annual License | 01/01/2026 | 12/31/2026 | $12,000 |\n| 01/01/2026 | 01/01/2026 | Implementation | 01/01/2026 | 01/01/2026 | $5,000 |\n\n### Example 4: Proration (Mid-Month Start)\n- Contract: 01/15/2026 - 12/31/2026\n- Charge: $100/month, Monthly, InAdvance\n\n| Invoice Date | Billing Date | Period Start | Period End | Amount | Notes |\n|--------------|--------------|--------------|------------|--------|-------|\n| 01/15/2026 | 01/15/2026 | 01/15/2026 | 01/31/2026 | $54.84 | 17/31 days |\n| 02/01/2026 | 02/01/2026 | 02/01/2026 | 02/28/2026 | $100 | Full month |\n| ... | ... | ... | ... | $100 | Full months |\n\n---\n\n## Contract Value Reconciliation (TCV Check) — REQUIRED\n\nBefore finalizing the invoice schedule, you MUST reconcile totals against the contract's Total Contract Value (TCV).\n\n1) **Determine the target TCV definition** (state it explicitly in the output):\n   - If the input provides **Gross TCV / Net TCV / discount %**, treat **Net TCV as the target**.\n   - If the contract includes **usage/drawdown/overage**, clarify whether TCV **includes an estimate of usage** or is **fixed-fees-only**:\n     - If an explicit usage estimate/bucket amount is provided, include it in the target.\n     - If no estimate is provided, **exclude usage from the target** and record an item in `open_questions`.\n\n2) **Compute an internal check-sum**:\n   - `schedule_total = sum(all invoice line amounts, including discounts or negative lines)`\n   - `delta = target_tcv - schedule_total`\n\n3) **Hard rule:** the final schedule MUST satisfy `abs(delta) <= $0.01`.\n   - If not, you must **recalculate** (correct unit prices, quantities, proration day-counts, discounts, drawdown/overage logic) until it matches.\n   - If matching is impossible due to missing/ambiguous inputs, do NOT guess; put the discrepancy and the missing assumption(s) in `open_questions` and provide the closest schedule with `delta` shown.\n\n4) **Discount handling:**\n   - Apply discounts either (a) as a separate negative invoice line item, or (b) by reducing each affected charge, but ensure the **net total equals Net TCV**.\n\n5) **Output requirement:** include a `totals` block showing `target_tcv`, `schedule_total`, and `delta`.\n\n---\n\n## Output\n\nReturn JSON with complete billing schedule:\n\n```json\n{\n  \"zb_billings\": [\n    {\n      \"Invoice Date\": \"01/01/2026\",\n      \"Billing Date\": \"01/01/2026\",\n      \"Charge Name\": \"Platform License\",\n      \"Rate Plan\": \"Standard Plan\",\n      \"Product\": \"Platform\",\n      \"Billing Period Start\": \"01/01/2026\",\n      \"Billing Period End\": \"01/31/2026\",\n      \"Quantity\": 1,\n      \"Unit Price\": 100,\n      \"Amount\": 100,\n      \"Currency\": \"USD\"\n    }\n  ],\n  \"totals\": {\n    \"target_tcv\": 1200,\n    \"schedule_total\": 1200,\n    \"delta\": 0\n  },\n  \"assumptions\": [\"All dates are based on calendar month boundaries\"],\n  \"open_questions\": []\n}\n```\n\n**Date formats:**\n- All dates in output: `MM/DD/YYYY`\n\n**Validation before returning:**\n1. Every charge from subscription spec has billing rows\n2. Billing periods are contiguous (no gaps)\n3. Total billed per charge = quantity × unitPrice × number of periods\n4. Proration math is correct for partial periods\n5. **TCV reconciliation: schedule_total matches target_tcv (delta ≤ $0.01)**\n\n---\n\n## Reference Documentation\n\n- Billing Timing: https://docs.zuora.com/en/zuora-billing/manage-bill-runs/billing-timing\n- Proration Overview: https://docs.zuora.com/en/zuora-billing/manage-subscriptions/proration/proration-overview\n- Partial Period Proration: https://docs.zuora.com/en/zuora-billing/manage-subscriptions/proration/calculate-total-with-partial-period-proration\n- Usage Charges: https://docs.zuora.com/en/zuora-billing/manage-product-catalog/charge-model-configurations/tiered-with-overage-charges\n- Invoice Management: https://docs.zuora.com/en/zuora-billing/manage-billing-documents/manage-invoices/invoice-management-overview\n- Bill Run Target Date: https://docs.zuora.com/en/zuora-billing/manage-bill-runs/bill-run-target-date"
        },
        {
          "role": "user",
          "content": "{\n  \"customer_name\": \"Quarterly Corp\",\n  \"contract_start_date\": \"01/01/2025\",\n  \"terms_months\": 12,\n  \"transaction_currency\": \"USD\",\n  \"billing_period\": \"Quarterly\",\n  \"is_allocations\": false,\n  \"use_case_description\": \"Professional services subscription:\\n- $3000/quarter ($1000/month equivalent)\\n- Quarterly billing in advance\\n- 12-month term\\n\"\n}"
        },
        {
          "role": "assistant",
          "content": "{\n  \"zb_billings\": [\n    {\n      \"Invoice Date\": \"01/01/2025\",\n      \"Billing Date\": \"01/01/2025\",\n      \"Charge Name\": \"Professional Services Subscription\",\n      \"Rate Plan\": \"Quarterly Retainer Plan\",\n      \"Product\": \"Professional Services\",\n      \"Billing Period Start\": \"01/01/2025\",\n      \"Billing Period End\": \"03/31/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 3000,\n      \"Amount\": 3000,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"04/01/2025\",\n      \"Billing Date\": \"04/01/2025\",\n      \"Charge Name\": \"Professional Services Subscription\",\n      \"Rate Plan\": \"Quarterly Retainer Plan\",\n      \"Product\": \"Professional Services\",\n      \"Billing Period Start\": \"04/01/2025\",\n      \"Billing Period End\": \"06/30/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 3000,\n      \"Amount\": 3000,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"07/01/2025\",\n      \"Billing Date\": \"07/01/2025\",\n      \"Charge Name\": \"Professional Services Subscription\",\n      \"Rate Plan\": \"Quarterly Retainer Plan\",\n      \"Product\": \"Professional Services\",\n      \"Billing Period Start\": \"07/01/2025\",\n      \"Billing Period End\": \"09/30/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 3000,\n      \"Amount\": 3000,\n      \"Currency\": \"USD\"\n    },\n    {\n      \"Invoice Date\": \"10/01/2025\",\n      \"Billing Date\": \"10/01/2025\",\n      \"Charge Name\": \"Professional Services Subscription\",\n      \"Rate Plan\": \"Quarterly Retainer Plan\",\n      \"Product\": \"Professional Services\",\n      \"Billing Period Start\": \"10/01/2025\",\n      \"Billing Period End\": \"12/31/2025\",\n      \"Quantity\": 1,\n      \"Unit Price\": 3000,\n      \"Amount\": 3000,\n      \"Currency\": \"USD\"\n    }\n  ],\n  \"assumptions\": [\n    \"Billing periods are aligned with the calendar quarter starting from the service start date.\",\n    \"Billing timing is set to In Advance, meaning the Invoice Date matches the Billing Period Start date.\",\n    \"The target TCV is calculated as the fixed recurring fee over the 12-month term ($3,000 * 4 quarters).\"\n  ],\n  \"open_questions\": [],\n  \"totals\": {\n    \"target_tcv\": 12000,\n    \"schedule_total\": 12000,\n    \"delta\": 0\n  }\n}"
        }
      ],
      "metadata": {
        "test_case_id": "quarterly-billing-annual",
        "model": "gemini-3-flash-preview",
        "run_id": "a56ca45d-6bd5-43b5-a765-248eb581ed3c",
        "created_at": "2025-12-31T03:39:52.752Z"
      }
    },
    {
      "id": "41bc6c94-3272-4dee-addd-c9434299dc6f",
      "step_name": "revrec_waterfall",
      "source": "evaluation_pass",
      "messages": [
        {
          "role": "system",
          "content": "You are a Zuora Revenue expert generating the monthly recognition waterfall. For each line from Contracts/Orders, calculate how revenue is recognized over time.\n\n---\n\n## CRITICAL: Follow WATERFALL INSTRUCTIONS\n\nEach POB in the input includes **WATERFALL INSTRUCTIONS**. These are AUTHORITATIVE. Follow them exactly:\n\n- If instructions say \"ratable\" → spread evenly over revenue window\n- If instructions say \"point-in-time\" → recognize 100% in one period\n- If instructions say \"event-driven\" → recognize ONLY when events occur\n\n**For event-driven POBs (EVT-PIT-*):** If no usage/event data provided, set Amount = $0 for all periods and add open question.\n\n---\n\n## Input Context\n\nYou will receive:\n- **Contracts/Orders table** — Line items with Ext Allocated Price, revenue dates\n- **POB mappings** — Template and WATERFALL INSTRUCTIONS for each line\n- **Contract intel** — dates and terms\n\n---\n\n## Recognition Patterns\n\n### Pattern 1: Ratable (Over Time)\n\n**POB templates:** BK-OT-*, BL-OT-* (any with \"-OT-\")\n\n**Calculation:**\n```\nDaily Rate = Ext Allocated Price / Total Days in Revenue Window\nMonthly Amount = Daily Rate × Days in Month\n```\n\n**Output:** One row per month in the revenue window.\n\n**Example:** $12,000 allocated, Jan 1 - Dec 31 (365 days)\n- Daily rate: $12,000 / 365 = $32.88/day\n- Jan (31 days): $32.88 × 31 = $1,019.18\n- Feb (28 days): $32.88 × 28 = $920.55\n- ... etc.\n\n### Pattern 2: Point-in-Time (Immediate)\n\n**POB templates:** BK-PIT-*, BL-PIT-* (any with \"-PIT-\")\n\n**Calculation:**\n```\n100% recognized in ONE period\n```\n\n**Which period?**\n| Release Event | Period |\n|--------------|--------|\n| Upon Booking | Month of Sales Order Date |\n| Upon Billing | Month of first invoice |\n| Acceptance | Month of Customer Acceptance Date |\n| Go-Live | Month of Service Activation Date |\n\n**Output:** ONE row with full Ext Allocated Price.\n\n### Pattern 3: Event-Driven (Consumption)\n\n**POB templates:** EVT-PIT-CONSUMP-*, EVT-PIT-USAGE, EVT-PIT-QTY\n\n**Calculation:**\n```\nAmount = 0 until event occurs\nWhen event: Amount = Event Quantity × Unit Rate\n```\n\n**CRITICAL:** Do NOT spread ratably. Revenue = $0 until consumption events.\n\n**If no event data provided:** All periods show $0, add open question asking for usage data.\n\n---\n\n## Ramp Deals\n\nWhen charges are ramp segments (Year 1, Year 2, Year 3 at different prices):\n\n1. Calculate average rate: Total Value / Total Months\n2. Recognize using average rate each month (consistent amounts)\n\n**Example:** Y1: $10,000, Y2: $12,000, Y3: $14,000\n- Total: $36,000 / 36 months = $1,000/month\n- Every month recognizes $1,000 (not billing amounts)\n\n---\n\n## Contract Modifications\n\n### Retrospective (Same POB, Price/Term Change)\n\nWhen price changes on existing POB:\n\n1. Calculate NEW average rate: New Total Value / Total Months\n2. Apply to ALL periods (including closed)\n3. Catch-up = (New Rate - Old Rate) × Closed Months\n4. Show catch-up in MODIFICATION PERIOD\n\n**Example:** $5,000/mo × 24 mo → after 6 mo, increases to $6,000/mo\n- New Total: $30K + $108K = $138K\n- New Rate: $138K / 24 = $5,750/mo\n- Closed (6 mo): Should have been $5,750 × 6 = $34,500\n- Was recognized: $5,000 × 6 = $30,000\n- Catch-up in Month 7: $4,500\n\n### Prospective (New POB Added)\n\nWhen new distinct deliverable added:\n- Existing POB: unchanged recognition\n- New POB: separate allocation and recognition\n\n---\n\n## Prepay Drawdown (PPDD)\n\nPPDD has two recognition patterns based on POB template:\n\n### Ratable Recognition (BK-OT-CONSUMP-RATABLE)\n- Prepaid amount spread evenly over term\n- Recognition NOT tied to consumption\n- Example: $12,000 prepaid / 12 months = $1,000/month\n\n### Consumption Recognition (EVT-PIT-CONSUMP-USAGE)\n- Revenue = $0 until consumption events occur\n- Each consumption event: Amount = Units × Unit Rate\n- **CRITICAL:** Do NOT spread ratably—this is event-driven\n\n**If no consumption data provided:** Show $0 for all periods, add open question asking for usage schedule.\n\n---\n\n## Output\n\nGenerate one row per Line Item per Period:\n\n```json\n{\n  \"zr_revrec\": [\n    {\n      \"Line Item Num\": 1,\n      \"POB Name\": \"Platform License\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2026-01-01\",\n      \"Revenue End Date\": \"2026-12-31\",\n      \"Ext Allocated Price\": 12000,\n      \"Period\": \"Jan-26\",\n      \"Amount\": 1019.18\n    },\n    {\n      \"Line Item Num\": 1,\n      \"POB Name\": \"Platform License\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2026-01-01\",\n      \"Revenue End Date\": \"2026-12-31\",\n      \"Ext Allocated Price\": 12000,\n      \"Period\": \"Feb-26\",\n      \"Amount\": 920.55\n    }\n  ],\n  \"assumptions\": [\"Daily proration method used\"],\n  \"open_questions\": []\n}\n```\n\n**Period format:** \"MMM-YY\" (e.g., \"Jan-26\", \"Feb-26\")\n\n**Validation before returning:**\n1. Sum of all Amount for each Line Item = Ext Allocated Price\n2. Periods cover Revenue Start to Revenue End with no gaps\n3. Event-driven charges show $0 when no events provided\n4. POB Name and Event Name match the POB mapping\n\n---\n\n## Reference Documentation\n\n- Revenue Waterfall: https://docs.zuora.com/en/zuora-revenue/day-to-day-operation/waterfall-summary\n- Contract Modifications: https://docs.zuora.com/en/zuora-revenue/advanced-revenue-operations/contract-modifications\n- Ramp Deals: https://docs.zuora.com/en/zuora-revenue/day-to-day-operation/ramp-deals\n- VC Processing: https://docs.zuora.com/en/zuora-revenue/day-to-day-operation/variable-consideration-processing\n- Prepaid with Drawdown: https://docs.zuora.com/en/zuora-billing/manage-subscriptions/prepaid-with-drawdown"
        },
        {
          "role": "user",
          "content": "{\n  \"customer_name\": \"Bundle Customer\",\n  \"contract_start_date\": \"01/01/2025\",\n  \"terms_months\": 12,\n  \"transaction_currency\": \"USD\",\n  \"billing_period\": \"Monthly\",\n  \"is_allocations\": true,\n  \"allocation_method\": \"Use List Price\",\n  \"use_case_description\": \"Software bundle with multiple elements:\\n- Core Platform: $500/month (list price $600)\\n- Premium Support: $100/month (list price $150)\\n- Implementation Services: $2000 one-time (list price $2500)\\nTotal bundle: $8200/year\\n\"\n}"
        },
        {
          "role": "assistant",
          "content": "{\n  \"zr_revrec\": [\n    {\n      \"Line Item Num\": 1,\n      \"POB Name\": \"Core Platform\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Ext Allocated Price\": 5760,\n      \"Period\": \"Jan-25\",\n      \"Amount\": 489.21\n    },\n    {\n      \"Line Item Num\": 1,\n      \"POB Name\": \"Core Platform\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Ext Allocated Price\": 5760,\n      \"Period\": \"Feb-25\",\n      \"Amount\": 441.86\n    },\n    {\n      \"Line Item Num\": 1,\n      \"POB Name\": \"Core Platform\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Ext Allocated Price\": 5760,\n      \"Period\": \"Mar-25\",\n      \"Amount\": 489.21\n    },\n    {\n      \"Line Item Num\": 1,\n      \"POB Name\": \"Core Platform\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Ext Allocated Price\": 5760,\n      \"Period\": \"Apr-25\",\n      \"Amount\": 473.42\n    },\n    {\n      \"Line Item Num\": 1,\n      \"POB Name\": \"Core Platform\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Ext Allocated Price\": 5760,\n      \"Period\": \"May-25\",\n      \"Amount\": 489.21\n    },\n    {\n      \"Line Item Num\": 1,\n      \"POB Name\": \"Core Platform\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Ext Allocated Price\": 5760,\n      \"Period\": \"Jun-25\",\n      \"Amount\": 473.42\n    },\n    {\n      \"Line Item Num\": 1,\n      \"POB Name\": \"Core Platform\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Ext Allocated Price\": 5760,\n      \"Period\": \"Jul-25\",\n      \"Amount\": 489.21\n    },\n    {\n      \"Line Item Num\": 1,\n      \"POB Name\": \"Core Platform\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Ext Allocated Price\": 5760,\n      \"Period\": \"Aug-25\",\n      \"Amount\": 489.21\n    },\n    {\n      \"Line Item Num\": 1,\n      \"POB Name\": \"Core Platform\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Ext Allocated Price\": 5760,\n      \"Period\": \"Sep-25\",\n      \"Amount\": 473.42\n    },\n    {\n      \"Line Item Num\": 1,\n      \"POB Name\": \"Core Platform\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Ext Allocated Price\": 5760,\n      \"Period\": \"Oct-25\",\n      \"Amount\": 489.21\n    },\n    {\n      \"Line Item Num\": 1,\n      \"POB Name\": \"Core Platform\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Ext Allocated Price\": 5760,\n      \"Period\": \"Nov-25\",\n      \"Amount\": 473.42\n    },\n    {\n      \"Line Item Num\": 1,\n      \"POB Name\": \"Core Platform\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Ext Allocated Price\": 5760,\n      \"Period\": \"Dec-25\",\n      \"Amount\": 489.2\n    },\n    {\n      \"Line Item Num\": 2,\n      \"POB Name\": \"Premium Support\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Ext Allocated Price\": 1440,\n      \"Period\": \"Jan-25\",\n      \"Amount\": 122.3\n    },\n    {\n      \"Line Item Num\": 2,\n      \"POB Name\": \"Premium Support\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Ext Allocated Price\": 1440,\n      \"Period\": \"Feb-25\",\n      \"Amount\": 110.47\n    },\n    {\n      \"Line Item Num\": 2,\n      \"POB Name\": \"Premium Support\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Ext Allocated Price\": 1440,\n      \"Period\": \"Mar-25\",\n      \"Amount\": 122.3\n    },\n    {\n      \"Line Item Num\": 2,\n      \"POB Name\": \"Premium Support\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Ext Allocated Price\": 1440,\n      \"Period\": \"Apr-25\",\n      \"Amount\": 118.36\n    },\n    {\n      \"Line Item Num\": 2,\n      \"POB Name\": \"Premium Support\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Ext Allocated Price\": 1440,\n      \"Period\": \"May-25\",\n      \"Amount\": 122.3\n    },\n    {\n      \"Line Item Num\": 2,\n      \"POB Name\": \"Premium Support\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Ext Allocated Price\": 1440,\n      \"Period\": \"Jun-25\",\n      \"Amount\": 118.36\n    },\n    {\n      \"Line Item Num\": 2,\n      \"POB Name\": \"Premium Support\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Ext Allocated Price\": 1440,\n      \"Period\": \"Jul-25\",\n      \"Amount\": 122.3\n    },\n    {\n      \"Line Item Num\": 2,\n      \"POB Name\": \"Premium Support\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Ext Allocated Price\": 1440,\n      \"Period\": \"Aug-25\",\n      \"Amount\": 122.3\n    },\n    {\n      \"Line Item Num\": 2,\n      \"POB Name\": \"Premium Support\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Ext Allocated Price\": 1440,\n      \"Period\": \"Sep-25\",\n      \"Amount\": 118.36\n    },\n    {\n      \"Line Item Num\": 2,\n      \"POB Name\": \"Premium Support\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Ext Allocated Price\": 1440,\n      \"Period\": \"Oct-25\",\n      \"Amount\": 122.3\n    },\n    {\n      \"Line Item Num\": 2,\n      \"POB Name\": \"Premium Support\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Ext Allocated Price\": 1440,\n      \"Period\": \"Nov-25\",\n      \"Amount\": 118.36\n    },\n    {\n      \"Line Item Num\": 2,\n      \"POB Name\": \"Premium Support\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-12-31\",\n      \"Ext Allocated Price\": 1440,\n      \"Period\": \"Dec-25\",\n      \"Amount\": 122.29\n    },\n    {\n      \"Line Item Num\": 3,\n      \"POB Name\": \"Implementation Services\",\n      \"Event Name\": \"Upon Booking\",\n      \"Revenue Start Date\": \"2025-01-01\",\n      \"Revenue End Date\": \"2025-01-01\",\n      \"Ext Allocated Price\": 2000,\n      \"Period\": \"Jan-25\",\n      \"Amount\": 2000\n    }\n  ],\n  \"assumptions\": [\n    \"Daily proration method used for ratable POBs (BK-OT-RATABLE)\",\n    \"Reconciliation adjustment applied to Dec-25 to ensure sum of periods equals Ext Allocated Price\",\n    \"Implementation Services recognized 100% in Jan-25 as per BK-PIT-STARTDATE instructions\"\n  ],\n  \"open_questions\": []\n}"
        }
      ],
      "metadata": {
        "test_case_id": "multi-element-allocation",
        "model": "gemini-3-flash-preview",
        "run_id": "a56ca45d-6bd5-43b5-a765-248eb581ed3c",
        "created_at": "2025-12-31T03:42:34.407Z"
      }
    }
  ]
}